import{c as H,j as e,R as X,r as a}from"./index-CKnKs3oX.js";const P={NEW:"bg-sky-50 text-sky-700 ring-sky-100",MATCHED:"bg-emerald-50 text-emerald-700 ring-emerald-100",CREATED:"bg-amber-50 text-amber-800 ring-amber-100",EXCLUDED:"bg-slate-50 text-slate-500 ring-slate-100"},W={NEW:"New",MATCHED:"Matched",CREATED:"Created",EXCLUDED:"Excluded"};function p(s){const c=typeof s=="number"?s:Number(s||0),N=c<0?"-":"",g=Math.abs(c).toFixed(2);return`${N}$${g}`}function L({status:s}){const c=P[s]||"bg-slate-50 text-slate-500 ring-slate-100";return e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-[11px] font-medium ring-1 ${c}`,children:W[s]||s})}function R({side:s}){const c=s==="IN";return e.jsxs("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-medium ring-1 ${c?"bg-emerald-50 text-emerald-700 ring-emerald-100":"bg-rose-50 text-rose-700 ring-rose-100"}`,children:[e.jsx("span",{className:"mr-1.5 h-1.5 w-1.5 rounded-full bg-current"}),c?"Money in":"Money out"]})}function O(){const[s,c]=a.useState([]),[N,g]=a.useState(!0),[E,S]=a.useState(null),[d,C]=a.useState(null),[m,T]=a.useState({}),[y,A]=a.useState([]),[_,v]=a.useState(!1),[M,w]=a.useState(null),[h,I]=a.useState("ALL"),[f,U]=a.useState("CREATE"),[j,u]=a.useState(null);a.useEffect(()=>{let t=!0;return g(!0),S(null),fetch("/api/banking/overview/",{credentials:"same-origin"}).then(n=>{if(!n.ok)throw new Error("Unable to load bank accounts.");return n.json()}).then(n=>{if(!t)return;const i=(n.accounts||[]).map(x=>({id:x.id,name:x.name,last4:x.last4||"",ledgerBalance:Number(x.ledger_balance||0)}));c(i)}).catch(n=>{t&&S(n.message)}).finally(()=>{t&&g(!1)}),()=>{t=!1}},[]),a.useEffect(()=>{!d&&s.length>0&&C(s[0].id)},[s,d]),a.useEffect(()=>{if(!d){A([]),T({}),u(null),w(null),v(!1);return}let t=!0;v(!0),w(null);const n=new URLSearchParams;return n.set("account_id",String(d)),n.set("status",h),fetch(`/api/banking/feed/transactions/?${n.toString()}`,{credentials:"same-origin"}).then(i=>{if(!i.ok)throw new Error("Unable to load transactions.");return i.json()}).then(i=>{var D;if(!t)return;const x=(i.transactions||[]).map(r=>({id:r.id,date:r.date,description:r.description,amount:Number(r.amount||0),status:r.status,side:r.side,posted_journal_entry:r.posted_journal_entry||null,expense_candidates:r.expense_candidates||[],invoice_candidates:r.invoice_candidates||[]}));A(x),T({NEW:0,MATCHED:0,CREATED:0,EXCLUDED:0,...i.status_counts||{}});const B=Number(((D=i.account)==null?void 0:D.ledger_balance)??i.balance??0);c(r=>r.map(k=>k.id===d?{...k,ledgerBalance:B}:k)),x.length>0?u(x[0].id):u(null)}).catch(i=>{t&&w(i.message)}).finally(()=>{t&&v(!1)}),()=>{t=!1}},[d,h]);const o=a.useMemo(()=>h==="ALL"?y:y.filter(t=>t.status===h),[y,h]);a.useEffect(()=>{if(o.length===0){u(null);return}if(!j){u(o[0].id);return}o.some(t=>t.id===j)||u(o[0].id)},[o,j]);const b=s.find(t=>t.id===d)||null,l=o.find(t=>t.id===j)||o[0]||null,F=[{key:"ALL",label:"All",count:a.useMemo(()=>Object.keys(m).reduce((t,n)=>t+Number(m[n]||0),0),[m])},{key:"NEW",label:"New",count:m.NEW??0},{key:"MATCHED",label:"Matched",count:m.MATCHED??0},{key:"CREATED",label:"Created",count:m.CREATED??0},{key:"EXCLUDED",label:"Excluded",count:m.EXCLUDED??0}];return e.jsx("div",{className:"min-h-screen bg-slate-50 text-slate-900 font-sans",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-6 py-8",children:[e.jsxs("header",{className:"mb-6 flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold tracking-[0.18em] text-slate-400 uppercase mb-2",children:"BANK FEED"}),e.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-900 mb-1",children:"Review bank transactions"}),e.jsx("p",{className:"text-sm text-slate-500 max-w-xl",children:"Match bank activity to invoices and expenses, or create new transactions directly from your feed."})]}),e.jsxs("div",{className:"flex flex-col items-stretch gap-3 sm:items-end",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{className:"h-9 rounded-full border border-slate-200 bg-white px-3 text-xs font-medium text-slate-700 shadow-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-100",value:d??"",onChange:t=>C(t.target.value?Number(t.target.value):null),disabled:N||!s.length,children:s.map(t=>e.jsx("option",{value:t.id,children:`${t.name}${t.last4?` ••••${t.last4}`:""}`},t.id))}),e.jsx("a",{href:"/bank-feeds/import/",className:"inline-flex items-center rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-600 shadow-sm hover:bg-slate-50",children:"Import CSV"})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white px-3 py-2 text-right text-xs text-slate-500 shadow-sm",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-slate-400 mb-1",children:"Current balance (ledger)"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:b?p(b.ledgerBalance):"—"})]})]})]}),E&&e.jsx("div",{className:"mb-4 rounded-2xl border border-rose-100 bg-rose-50 px-4 py-3 text-xs text-rose-600",children:E}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-[minmax(0,2.2fr)_minmax(0,3fr)]",children:[e.jsxs("section",{className:"rounded-3xl bg-white shadow-[0_18px_45px_rgba(15,23,42,0.06)] ring-1 ring-slate-100 flex flex-col min-h-[420px]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 border-b border-slate-100 px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-[13px] font-semibold text-slate-900",children:"Imported transactions"}),e.jsx("p",{className:"text-[11px] text-slate-500",children:"Review and assign each line to keep your books up to date."})]}),e.jsx("div",{className:"flex gap-1 rounded-full bg-slate-50 p-1",children:F.map(t=>e.jsxs("button",{type:"button",onClick:()=>I(t.key),className:`rounded-full px-2.5 py-1 text-[11px] font-medium transition ${h===t.key?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-800"}`,children:[e.jsx("span",{children:t.label}),e.jsx("span",{className:"ml-1 text-[10px] font-semibold text-slate-400",children:t.count??0})]},t.key))})]}),e.jsx("div",{className:"border-b border-slate-100 px-4 py-2",children:e.jsx("input",{type:"search",placeholder:"Search description or amount",className:"h-8 w-full rounded-full border border-slate-200 bg-slate-50 px-3 text-xs text-slate-700 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",disabled:!0})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:M?e.jsx("div",{className:"flex h-full flex-col items-center justify-center px-8 py-10 text-center text-xs text-rose-500",children:e.jsx("p",{children:M})}):_?e.jsx("div",{className:"flex h-full flex-col items-center justify-center px-8 py-10 text-center text-xs text-slate-400",children:e.jsx("p",{children:"Loading transactions…"})}):o.length===0?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center px-8 py-10 text-center text-xs text-slate-400",children:[e.jsx("p",{children:"No transactions for this filter yet."}),e.jsx("p",{className:"mt-1",children:"Try switching the status filter or importing a new CSV."})]}):e.jsx("ul",{className:"divide-y divide-slate-100",children:o.map(t=>{const n=l&&t.id===l.id;return e.jsx("li",{className:`cursor-pointer px-4 py-3 text-xs transition hover:bg-slate-50 ${n?"bg-slate-50":"bg-white"}`,onClick:()=>u(t.id),children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[11px] font-medium text-slate-500",children:t.date}),e.jsx(L,{status:t.status})]}),e.jsx("p",{className:"mt-1 truncate text-[13px] font-medium text-slate-900",children:t.description})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(R,{side:t.side}),e.jsx("div",{className:`text-sm font-semibold ${t.amount>=0?"text-emerald-600":"text-rose-600"}`,children:p(t.amount)})]})]})},t.id)})})})]}),e.jsx("section",{className:"rounded-3xl bg-white shadow-[0_18px_45px_rgba(15,23,42,0.06)] ring-1 ring-slate-100 min-h-[420px] flex flex-col",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-slate-100 px-6 py-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-semibold tracking-[0.16em] text-slate-400 uppercase",children:l.date}),e.jsx("h2",{className:"mt-1 text-sm font-semibold text-slate-900",children:l.description}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-[11px] text-slate-500",children:[e.jsx(R,{side:l.side}),e.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 font-medium text-slate-500 ring-1 ring-slate-100",children:"From feed • Pending review"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-lg font-semibold ${l.amount>=0?"text-emerald-600":"text-rose-600"}`,children:p(l.amount)}),e.jsxs("div",{className:"mt-1 text-[11px] text-slate-500",children:["Status: ",e.jsx(L,{status:l.status})]})]})]})}),e.jsx("div",{className:"border-b border-slate-100 px-6",children:e.jsx("nav",{className:"flex gap-4 text-xs font-medium text-slate-500",children:[{key:"CREATE",label:"Create"},{key:"MATCH",label:"Match"},{key:"TRANSFER",label:"Transfer"},{key:"EXCLUDE",label:"Exclude"}].map(t=>e.jsxs("button",{type:"button",onClick:()=>U(t.key),className:`relative py-3 transition ${f===t.key?"text-slate-900":"text-slate-500 hover:text-slate-800"}`,children:[t.label,f===t.key&&e.jsx("span",{className:"absolute inset-x-0 -bottom-px block h-[2px] rounded-full bg-sky-500"})]},t.key))})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 text-sm",children:[f==="CREATE"&&e.jsxs("div",{className:"space-y-5 max-w-md",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Turn this bank line into a new expense or income entry. Mini-Books will post it to the right accounts in your ledger."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Transaction type"}),e.jsxs("div",{className:"inline-flex gap-1 rounded-full bg-slate-50 p-1 text-xs font-medium",children:[e.jsx("button",{className:"rounded-full bg-white px-3 py-1 shadow-sm text-slate-900",children:l.amount>=0?"Income":"Expense"}),e.jsx("button",{className:"rounded-full px-3 py-1 text-slate-400",disabled:!0,children:"Transfer"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Category"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:l.amount>=0?"e.g. Product sales":"e.g. Software subscriptions"})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Contact (customer or supplier)"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"Optional"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Memo"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"Internal note"})]})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{className:"inline-flex items-center rounded-full bg-emerald-600 px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-emerald-700",children:"Create & post to ledger"})})]})]}),f==="MATCH"&&l&&e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-xs text-slate-500 max-w-md",children:"Match this bank line to an existing invoice or expense. Once matched, the payment will be reflected in your reports."}),e.jsxs("div",{className:"space-y-3 max-w-md",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Suggested matches"}),e.jsx("div",{className:"space-y-2 rounded-2xl border border-slate-100 bg-slate-50 p-3 text-xs",children:l.amount>=0?l.invoice_candidates.length>0?l.invoice_candidates.map(t=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-slate-800",children:[t.invoice_number?`Invoice #${t.invoice_number}`:"Invoice",t.customer?` · ${t.customer}`:""]}),e.jsxs("div",{className:"text-[11px] text-slate-500",children:[t.date," • ",p(t.amount)]})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"mt-1 text-[11px] font-medium text-sky-600",children:"Match"})})]},t.id)):e.jsx("div",{className:"text-[11px] text-slate-500",children:"No invoice suggestions yet."}):l.expense_candidates.length>0?l.expense_candidates.map(t=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-800",children:t.description||"Expense"}),e.jsxs("div",{className:"text-[11px] text-slate-500",children:[t.date," • ",p(t.amount)]})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"mt-1 text-[11px] font-medium text-sky-600",children:"Match"})})]},t.id)):e.jsx("div",{className:"text-[11px] text-slate-500",children:"No expense suggestions yet."})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Search by invoice or expense"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"Start typing a customer, invoice #, or amount",disabled:!0})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{className:"inline-flex items-center rounded-full bg-slate-900 px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-black",children:"Confirm match"})})]})]}),f==="TRANSFER"&&e.jsxs("div",{className:"space-y-5 max-w-md",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Use a transfer when this movement is between your own accounts (for example, moving money from checking to savings)."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"From account"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",defaultValue:(b==null?void 0:b.name)||"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"To account"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"e.g. Savings, Credit card"})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{className:"inline-flex items-center rounded-full bg-sky-600 px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-sky-700",children:"Record transfer"})})]})]}),f==="EXCLUDE"&&e.jsxs("div",{className:"space-y-4 max-w-md",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Exclude this line if it's a duplicate, personal transaction, or otherwise not relevant to your business books. It will remain in the feed but won't affect your reports."}),e.jsx("div",{className:"rounded-2xl border border-rose-100 bg-rose-50 px-3 py-3 text-[11px] text-rose-700",children:"You can always undo this later from the bank feed if you exclude something by mistake."}),e.jsx("button",{className:"inline-flex items-center rounded-full bg-white px-4 py-1.5 text-xs font-semibold text-rose-600 ring-1 ring-rose-200 hover:bg-rose-50",children:"Exclude from books"})]})]})]}):_?e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center px-8 py-10 text-center text-xs text-slate-400",children:e.jsx("p",{children:"Loading transaction…"})}):e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center px-8 py-10 text-center text-xs text-slate-400",children:e.jsx("p",{children:"Select a transaction on the left to review or create a posting."})})})]})]})})}const $=document.getElementById("bank-feed-root");$&&H.createRoot($).render(e.jsx(X.StrictMode,{children:e.jsx(O,{})}));
