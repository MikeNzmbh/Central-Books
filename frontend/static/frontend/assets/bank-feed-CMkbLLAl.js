import{c as at,j as e,R as nt,r as n}from"./index-D5k505X5.js";const lt={NEW:"bg-sky-50 text-sky-700 ring-sky-100",PARTIAL:"bg-amber-50 text-amber-800 ring-amber-100",MATCHED_SINGLE:"bg-emerald-50 text-emerald-700 ring-emerald-100",MATCHED_MULTI:"bg-emerald-50 text-emerald-700 ring-emerald-100",EXCLUDED:"bg-slate-50 text-slate-500 ring-slate-100"},ot={NEW:"New",PARTIAL:"Partial",MATCHED_SINGLE:"Matched",MATCHED_MULTI:"Matched (multi)",EXCLUDED:"Excluded"};function y(d){const u=typeof d=="number"?d:Number(d||0),L=u<0?"-":"",j=Math.abs(u).toFixed(2);return`${L}$${j}`}function rt(d){if(typeof document>"u")return null;const u=document.cookie?document.cookie.split(";"):[];for(const L of u){const j=L.trim();if(j.startsWith(`${d}=`))return decodeURIComponent(j.substring(d.length+1))}return null}function Me({status:d}){const u=lt[d]||"bg-slate-50 text-slate-500 ring-slate-100";return e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-[11px] font-medium ring-1 ${u}`,children:ot[d]||d})}function Re({side:d}){const u=d==="IN";return e.jsxs("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-medium ring-1 ${u?"bg-emerald-50 text-emerald-700 ring-emerald-100":"bg-rose-50 text-rose-700 ring-rose-100"}`,children:[e.jsx("span",{className:"mr-1.5 h-1.5 w-1.5 rounded-full bg-current"}),u?"Money in":"Money out"]})}function it(){const[d,u]=n.useState([]),[L,j]=n.useState(!0),[fe,ge]=n.useState(null),[w,ye]=n.useState(null),[g,je]=n.useState({}),[ee,Ne]=n.useState([]),[ve,te]=n.useState(!1),[ke,se]=n.useState(null),[ae,Ue]=n.useState([]),[ne,$e]=n.useState([]),[Fe,Oe]=n.useState([]),[Pe,Ve]=n.useState([]),[B,we]=n.useState(!0),[Ee,Ce]=n.useState(null),[E,Be]=n.useState("ALL"),[C,He]=n.useState("ALLOCATE"),[H,N]=n.useState(null),[X,W]=n.useState(""),[M,G]=n.useState(""),[Ae,le]=n.useState(""),[Y,h]=n.useState(null),[z,v]=n.useState(null),[x,A]=n.useState(!1),[S,J]=n.useState({}),[I,R]=n.useState([]),[D,oe]=n.useState(""),[K,re]=n.useState(""),[U,ie]=n.useState(""),[q,ce]=n.useState(""),[$,de]=n.useState(""),[Q,ue]=n.useState(""),Se=n.useMemo(()=>rt("csrftoken"),[]),F=n.useCallback(async()=>{j(!0),ge(null);try{const t=await fetch("/api/banking/overview/",{credentials:"same-origin"});if(!t.ok)throw new Error("Unable to load bank accounts.");const l=((await t.json()).accounts||[]).map(o=>({id:o.id,name:o.name,last4:o.last4||"",ledgerBalance:Number(o.ledger_balance||0)}));u(l),ye(o=>{var c;return o&&l.some(m=>m.id===o)?o:((c=l[0])==null?void 0:c.id)??null})}catch(t){ge(t instanceof Error?t.message:"Unable to load bank accounts.")}finally{j(!1)}},[]);n.useEffect(()=>{F()},[F]);const O=n.useCallback(async()=>{var a;if(!w){Ne([]),je({}),N(null),se(null),te(!1);return}te(!0),se(null);const t=new URLSearchParams;t.set("account_id",String(w)),t.set("status",E);try{const l=await fetch(`/api/banking/feed/transactions/?${t.toString()}`,{credentials:"same-origin"});if(!l.ok)throw new Error("Unable to load transactions.");const o=await l.json(),c=(o.transactions||[]).map(i=>({id:i.id,date:i.date,description:i.description,amount:Number(i.amount||0),status:i.status,statusLabel:i.status_label||i.status,side:i.side,allocatedAmount:Number(i.allocated_amount||0),posted_journal_entry:i.posted_journal_entry||null,expense_candidates:i.expense_candidates||[],invoice_candidates:i.invoice_candidates||[]}));Ne(c),je({NEW:0,PARTIAL:0,MATCHED_SINGLE:0,MATCHED_MULTI:0,EXCLUDED:0,...o.status_counts||{}});const m=Number(((a=o.account)==null?void 0:a.ledger_balance)??o.balance??0);u(i=>i.map(p=>p.id===w?{...p,ledgerBalance:m}:p)),c.length>0?N(i=>i&&c.some(p=>p.id===i)?i:c[0].id):N(null)}catch(l){se(l instanceof Error?l.message:"Unable to load transactions.")}finally{te(!1)}},[w,E]);n.useEffect(()=>{O()},[O]),n.useEffect(()=>{let t=!0;return we(!0),Ce(null),fetch("/api/banking/feed/metadata/",{credentials:"same-origin"}).then(a=>{if(!a.ok)throw new Error("Unable to load categories.");return a.json()}).then(a=>{t&&(Ue(a.expense_categories||[]),$e(a.income_categories||[]),Oe(a.suppliers||[]),Ve(a.customers||[]))}).catch(a=>{t&&Ce(a.message)}).finally(()=>{t&&we(!1)}),()=>{t=!1}},[]);const xe=n.useCallback(async(t,a)=>{const l=await fetch(t,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRFToken":Se||""},body:JSON.stringify(a||{})});if(!l.ok){let o="Unable to complete action.";try{const c=await l.json();o=(c==null?void 0:c.detail)||(c==null?void 0:c.error)||o}catch{}throw new Error(o)}try{return await l.json()}catch{return{}}},[Se]),f=n.useMemo(()=>E==="ALL"?ee:ee.filter(t=>t.status===E),[ee,E]);n.useEffect(()=>{if(f.length===0){N(null);return}if(!H){N(f[0].id);return}f.some(t=>t.id===H)||N(f[0].id)},[f,H]);const P=d.find(t=>t.id===w)||null,s=f.find(t=>t.id===H)||f[0]||null;n.useEffect(()=>{if(!s){W(""),G("");return}const t=s.side==="OUT"?ae:ne;t.length>0?W(a=>a&&t.some(l=>String(l.id)===a)?a:String(t[0].id)):W(""),G(""),J({}),R([]),oe(""),re(""),ie(""),ce(""),de(""),ue("")},[s==null?void 0:s.id,ae,ne]),n.useEffect(()=>{le(""),h(null),v(null)},[s==null?void 0:s.id]);const me=s&&s.side==="OUT"?ae:ne,Ie=s&&s.side==="OUT"?Fe:Pe,Xe=s&&s.side==="OUT"?"Supplier":"Customer",Te=!!(s&&X),We=[{key:"ALL",label:"All",count:n.useMemo(()=>Object.keys(g).reduce((t,a)=>t+Number(g[a]||0),0),[g])},{key:"NEW",label:"New",count:g.NEW??0},{key:"PARTIAL",label:"Partial",count:g.PARTIAL??0},{key:"MATCHED_SINGLE",label:"Matched",count:g.MATCHED_SINGLE??0},{key:"MATCHED_MULTI",label:"Matched (multi)",count:g.MATCHED_MULTI??0},{key:"EXCLUDED",label:"Excluded",count:g.EXCLUDED??0}],k=(s==null?void 0:s.side)==="IN",_e=s?k?s.invoice_candidates:s.expense_candidates:[],Le=2,Z=Le/100,b=n.useCallback(t=>{if(typeof t!="string")return 0;const a=Number(t);return Number.isFinite(a)?a:0},[]),Ge=n.useCallback((t,a)=>{J(l=>{const o={...l};return a?o[t.id]=t.amount.toFixed(2):delete o[t.id],o})},[]),Ye=n.useCallback((t,a)=>{J(l=>({...l,[t]:a}))},[]),ze=n.useCallback(()=>{if(!s)return;const t=`manual-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,a=s.side==="IN"?"DIRECT_INCOME":"DIRECT_EXPENSE";R(l=>[...l,{key:t,type:a,accountId:"",amount:""}])},[s]),pe=n.useCallback((t,a)=>{R(l=>l.map(o=>o.key===t?{...o,...a}:o))},[]),Je=n.useCallback(t=>{R(a=>a.filter(l=>l.key!==t))},[]),T=n.useMemo(()=>{if(!s)return{bankAmount:0,totalAllocations:0,candidateTotal:0,manualTotal:0,feeValue:0,roundingValue:0,overpaymentValue:0,expectedBank:0,remaining:0,allocationCount:0,isReady:!1};const t=Object.values(S).reduce((_,he)=>_+b(he),0),a=I.reduce((_,he)=>_+b(he.amount),0),l=t+a,o=b(K),c=Number(q),m=Number.isFinite(c)?c:0,i=b(Q),p=Math.abs(s.amount),V=k?l+i-o-m:l+o+m,r=p-V,be=Object.keys(S).length+I.filter(_=>b(_.amount)>0&&_.accountId).length,Ze=o>0,et=m!==0,tt=i>0,st=l>0&&Math.abs(r)<=Z&&(!Ze||!!D)&&(!et||!!U)&&(!tt||!!$&&k);return{bankAmount:p,totalAllocations:l,candidateTotal:t,manualTotal:a,feeValue:o,roundingValue:m,overpaymentValue:i,expectedBank:V,remaining:r,allocationCount:be,isReady:st}},[S,I,K,q,Q,D,U,$,b,s,k,Z]),Ke=async()=>{if(!s||!X){h("Select a category before posting this entry.");return}A(!0),h(null),v(null);const t={category_id:Number(X),memo:Ae};s.side==="OUT"&&M&&(t.supplier_id=Number(M)),s.side==="IN"&&M&&(t.customer_id=Number(M));try{await xe(`/api/banking/feed/transactions/${s.id}/create/`,t),v("Entry posted to the ledger."),le(""),G(""),await Promise.all([O(),F()])}catch(a){h(a instanceof Error?a.message:"Unable to post this entry.")}finally{A(!1)}},qe=async()=>{if(!s)return;const t=s.side==="IN",a=Object.entries(S).map(([r,be])=>({id:Number(r),amountValue:b(be)})).filter(r=>r.amountValue>0).map(r=>({type:t?"INVOICE":"BILL",id:r.id,amount:r.amountValue.toFixed(2)})),l=I.map(r=>({type:r.type,account_id:r.accountId?Number(r.accountId):null,amountValue:b(r.amount)})).filter(r=>r.account_id&&r.amountValue>0).map(r=>({type:r.type,account_id:r.account_id,amount:r.amountValue.toFixed(2)})),o=[...a,...l];if(o.length===0){h("Add at least one allocation amount.");return}const c={allocations:o,tolerance_cents:Le,operation_id:`banktx-${s.id}-${Date.now()}`},m=b(K);D&&m>0&&(c.fees={account_id:Number(D),amount:m.toFixed(2)});const i=Number(q),p=Number.isFinite(i)?i:0;U&&p!==0&&(c.rounding={account_id:Number(U),amount:p.toFixed(2)});const V=b(Q);t&&$&&V>0&&(c.overpayment={account_id:Number($),amount:V.toFixed(2)}),A(!0),h(null),v(null);try{const r=await xe(`/api/banking/transactions/${s.id}/allocate/`,c);if(!(r!=null&&r.ok))throw new Error((r==null?void 0:r.error)||"Unable to allocate this transaction.");v("Allocation posted to the ledger."),J({}),R([]),oe(""),re(""),ie(""),ce(""),de(""),ue(""),await Promise.all([O(),F()])}catch(r){h(r instanceof Error?r.message:"Unable to allocate this transaction.")}finally{A(!1)}},Qe=async()=>{if(s){A(!0),h(null),v(null);try{await xe(`/api/banking/feed/transactions/${s.id}/exclude/`),v("Transaction excluded from review."),await Promise.all([O(),F()])}catch(t){h(t instanceof Error?t.message:"Unable to exclude this transaction.")}finally{A(!1)}}};return e.jsx("div",{className:"min-h-screen bg-slate-50 text-slate-900 font-sans",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-6 py-8",children:[e.jsxs("header",{className:"mb-6 flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold tracking-[0.18em] text-slate-400 uppercase mb-2",children:"BANK FEED"}),e.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-900 mb-1",children:"Review bank transactions"}),e.jsx("p",{className:"text-sm text-slate-500 max-w-xl",children:"Match bank activity to invoices and expenses, or create new transactions directly from your feed."})]}),e.jsxs("div",{className:"flex flex-col items-stretch gap-3 sm:items-end",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{className:"h-9 rounded-full border border-slate-200 bg-white px-3 text-xs font-medium text-slate-700 shadow-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-100",value:w??"",onChange:t=>ye(t.target.value?Number(t.target.value):null),disabled:L||!d.length,children:d.map(t=>e.jsx("option",{value:t.id,children:`${t.name}${t.last4?` ••••${t.last4}`:""}`},t.id))}),e.jsx("a",{href:"/bank-feeds/new/",className:"inline-flex items-center rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-600 shadow-sm hover:bg-slate-50",children:"Import CSV"})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white px-3 py-2 text-right text-xs text-slate-500 shadow-sm",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-slate-400 mb-1",children:"Current balance (ledger)"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:P?y(P.ledgerBalance):"—"})]})]})]}),fe&&e.jsx("div",{className:"mb-4 rounded-2xl border border-rose-100 bg-rose-50 px-4 py-3 text-xs text-rose-600",children:fe}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-[minmax(0,2.2fr)_minmax(0,3fr)]",children:[e.jsxs("section",{className:"rounded-3xl bg-white shadow-[0_18px_45px_rgba(15,23,42,0.06)] ring-1 ring-slate-100 flex flex-col min-h-[420px]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 border-b border-slate-100 px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-[13px] font-semibold text-slate-900",children:"Imported transactions"}),e.jsx("p",{className:"text-[11px] text-slate-500",children:"Review and assign each line to keep your books up to date."})]}),e.jsx("div",{className:"flex gap-1 rounded-full bg-slate-50 p-1",children:We.map(t=>e.jsxs("button",{type:"button",onClick:()=>Be(t.key),className:`rounded-full px-2.5 py-1 text-[11px] font-medium transition ${E===t.key?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-800"}`,children:[e.jsx("span",{children:t.label}),e.jsx("span",{className:"ml-1 text-[10px] font-semibold text-slate-400",children:t.count??0})]},t.key))})]}),e.jsx("div",{className:"border-b border-slate-100 px-4 py-2",children:e.jsx("input",{type:"search",placeholder:"Search description or amount",className:"h-8 w-full rounded-full border border-slate-200 bg-slate-50 px-3 text-xs text-slate-700 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",disabled:!0})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:ke?e.jsx("div",{className:"flex h-full flex-col items-center justify-center px-8 py-10 text-center text-xs text-rose-500",children:e.jsx("p",{children:ke})}):ve?e.jsx("div",{className:"flex h-full flex-col items-center justify-center px-8 py-10 text-center text-xs text-slate-400",children:e.jsx("p",{children:"Loading transactions…"})}):f.length===0?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center px-8 py-10 text-center text-xs text-slate-400",children:[e.jsx("p",{children:"No transactions for this filter yet."}),e.jsx("p",{className:"mt-1",children:"Try switching the status filter or importing a new CSV."})]}):e.jsx("ul",{className:"divide-y divide-slate-100",children:f.map(t=>{const a=s&&t.id===s.id;return e.jsx("li",{className:`cursor-pointer px-4 py-3 text-xs transition hover:bg-slate-50 ${a?"bg-slate-50":"bg-white"}`,onClick:()=>N(t.id),children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[11px] font-medium text-slate-500",children:t.date}),e.jsx(Me,{status:t.status})]}),e.jsx("p",{className:"mt-1 truncate text-[13px] font-medium text-slate-900",children:t.description})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(Re,{side:t.side}),e.jsx("div",{className:`text-sm font-semibold ${t.amount>=0?"text-emerald-600":"text-rose-600"}`,children:y(t.amount)})]})]})},t.id)})})})]}),e.jsx("section",{className:"rounded-3xl bg-white shadow-[0_18px_45px_rgba(15,23,42,0.06)] ring-1 ring-slate-100 min-h-[420px] flex flex-col",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-slate-100 px-6 py-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-semibold tracking-[0.16em] text-slate-400 uppercase",children:s.date}),e.jsx("h2",{className:"mt-1 text-sm font-semibold text-slate-900",children:s.description}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-[11px] text-slate-500",children:[e.jsx(Re,{side:s.side}),e.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 font-medium text-slate-500 ring-1 ring-slate-100",children:"Bank feed"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-lg font-semibold ${s.amount>=0?"text-emerald-600":"text-rose-600"}`,children:y(s.amount)}),e.jsxs("div",{className:"mt-1 flex items-center justify-end gap-2 text-[11px] text-slate-500",children:["Status: ",e.jsx(Me,{status:s.status})]}),e.jsxs("div",{className:"text-[11px] text-slate-500",children:["Allocated: ",y(s.allocatedAmount)]})]})]})}),e.jsx("div",{className:"border-b border-slate-100 px-6",children:e.jsx("nav",{className:"flex gap-4 text-xs font-medium text-slate-500",children:[{key:"ALLOCATE",label:"Allocate"},{key:"CREATE",label:"Create"},{key:"TRANSFER",label:"Transfer"},{key:"EXCLUDE",label:"Exclude"}].map(t=>e.jsxs("button",{type:"button",onClick:()=>He(t.key),className:`relative py-3 transition ${C===t.key?"text-slate-900":"text-slate-500 hover:text-slate-800"}`,children:[t.label,C===t.key&&e.jsx("span",{className:"absolute inset-x-0 -bottom-px block h-[2px] rounded-full bg-sky-500"})]},t.key))})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 text-sm",children:[Y&&e.jsx("div",{className:"mb-3 rounded-2xl border border-rose-100 bg-rose-50 px-3 py-2 text-[11px] text-rose-600",children:Y}),z&&e.jsx("div",{className:"mb-3 rounded-2xl border border-emerald-100 bg-emerald-50 px-3 py-2 text-[11px] text-emerald-700",children:z}),C==="CREATE"&&e.jsxs("div",{className:"space-y-5 max-w-md",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Turn this bank line into a new expense or income entry. Mini-Books will post it to the right accounts in your ledger."}),Ee&&e.jsx("div",{className:"rounded-2xl border border-rose-100 bg-rose-50 px-3 py-2 text-[11px] text-rose-600",children:Ee}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Transaction type"}),e.jsxs("div",{className:"inline-flex gap-1 rounded-full bg-slate-50 p-1 text-xs font-medium",children:[e.jsx("button",{className:"rounded-full bg-white px-3 py-1 shadow-sm text-slate-900",children:s.amount>=0?"Income":"Expense"}),e.jsx("button",{className:"rounded-full px-3 py-1 text-slate-400",disabled:!0,children:"Transfer"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Category"}),e.jsx("select",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-white px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100 disabled:cursor-not-allowed disabled:bg-slate-100",value:X,onChange:t=>W(t.target.value),disabled:B||me.length===0||x,children:me.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))}),!B&&me.length===0&&e.jsxs("p",{className:"mt-1 text-[11px] text-rose-500",children:["Add ",s.amount>=0?"income":"expense"," categories to your chart of accounts to post directly from the feed."]})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:[Xe," (optional)"]}),e.jsxs("select",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-white px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100 disabled:cursor-not-allowed disabled:bg-slate-100",value:M,onChange:t=>G(t.target.value),disabled:x||Ie.length===0,children:[e.jsx("option",{value:"",children:s.side==="OUT"?"No supplier":"No customer"}),Ie.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Memo"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"Internal note",value:Ae,onChange:t=>le(t.target.value),disabled:x})]})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"button",onClick:Ke,disabled:!Te||x||B,className:`inline-flex items-center rounded-full px-4 py-1.5 text-xs font-semibold text-white shadow-sm ${!Te||x||B?"cursor-not-allowed bg-emerald-400":"bg-emerald-600 hover:bg-emerald-700"}`,children:x?"Posting…":"Create & post to ledger"})})]})]}),C==="ALLOCATE"&&s&&e.jsxs("div",{className:"space-y-5",children:[z&&e.jsx("div",{className:"rounded-2xl border border-emerald-100 bg-emerald-50 px-3 py-2 text-[11px] text-emerald-700",children:z}),Y&&e.jsx("div",{className:"rounded-2xl border border-rose-100 bg-rose-50 px-3 py-2 text-[11px] text-rose-600",children:Y}),e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-slate-50 px-4 py-4",children:[e.jsx("div",{className:"mb-3 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-[11px] font-semibold text-slate-500 uppercase",children:["Suggested ",k?"invoices":"bills"]}),e.jsx("p",{className:"text-[11px] text-slate-500",children:"Select which documents this bank line belongs to."})]})}),e.jsx("div",{className:"space-y-3",children:_e.length?_e.map(t=>{const a=Object.prototype.hasOwnProperty.call(S,t.id),l=S[t.id]||"";return e.jsx("div",{className:"rounded-xl bg-white px-3 py-2 text-xs text-slate-700 shadow-sm",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500",checked:a,onChange:o=>Ge(t,o.target.checked)}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-slate-900",children:[t.invoice_number?`Invoice #${t.invoice_number}`:t.description||(k?"Invoice":"Bill"),t.customer?` · ${t.customer}`:""]}),e.jsxs("div",{className:"text-[11px] text-slate-500",children:[t.date," • ",y(t.amount)]})]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"h-9 w-32 rounded-full border border-slate-200 bg-white px-3 text-right text-xs text-slate-800 outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100 disabled:bg-slate-100",value:l,disabled:!a,onChange:o=>Ye(t.id,o.target.value)})]})},t.id)}):e.jsx("p",{className:"text-[11px] text-slate-500",children:"No suggestions yet."})})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white px-4 py-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-semibold text-slate-500 uppercase",children:"Additional splits"}),e.jsx("p",{className:"text-[11px] text-slate-500",children:"Send part of the amount directly to ledger accounts."})]}),e.jsx("button",{type:"button",onClick:ze,className:"inline-flex items-center rounded-full bg-slate-900 px-3 py-1 text-[11px] font-semibold text-white shadow-sm hover:bg-black",children:"+ Add split"})]}),e.jsxs("div",{className:"space-y-3 text-xs",children:[I.length===0&&e.jsx("p",{className:"text-[11px] text-slate-500",children:"No manual splits yet."}),I.map(t=>{const a=s.side==="IN"?[{value:"DIRECT_INCOME",label:"Direct income"}]:[{value:"DIRECT_EXPENSE",label:"Direct expense"}];return e.jsx("div",{className:"rounded-xl border border-slate-100 bg-slate-50 px-3 py-2",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("select",{value:t.type,onChange:l=>pe(t.key,{type:l.target.value}),className:"h-9 rounded-full border border-slate-200 bg-white px-3 text-xs outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100",disabled:a.length===1,children:a.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))}),e.jsx("input",{className:"h-9 flex-1 rounded-full border border-slate-200 bg-white px-3 text-xs outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100",placeholder:"Account ID",value:t.accountId,onChange:l=>pe(t.key,{accountId:l.target.value})}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"h-9 w-28 rounded-full border border-slate-200 bg-white px-3 text-right text-xs outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100",placeholder:"Amount",value:t.amount,onChange:l=>pe(t.key,{amount:l.target.value})}),e.jsx("button",{type:"button",onClick:()=>Je(t.key),className:"text-[11px] font-medium text-rose-500 hover:text-rose-600",children:"Remove"})]})},t.key)})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white px-4 py-4",children:[e.jsx("p",{className:"text-[11px] font-semibold text-slate-500 uppercase mb-3",children:"Adjustments"}),e.jsxs("div",{className:"grid gap-3 text-xs md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[11px] font-medium text-slate-600",children:"Processor fee"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"h-9 flex-1 rounded-full border border-slate-200 bg-slate-50 px-3 text-xs outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"Account ID",value:D,onChange:t=>oe(t.target.value)}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"h-9 w-28 rounded-full border border-slate-200 bg-slate-50 px-3 text-right text-xs outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"0.00",value:K,onChange:t=>re(t.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[11px] font-medium text-slate-600",children:"Rounding"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"h-9 flex-1 rounded-full border border-slate-200 bg-slate-50 px-3 text-xs outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"Account ID",value:U,onChange:t=>ie(t.target.value)}),e.jsx("input",{type:"number",step:"0.01",className:"h-9 w-28 rounded-full border border-slate-200 bg-slate-50 px-3 text-right text-xs outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"0.00",value:q,onChange:t=>ce(t.target.value)})]})]}),k&&e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-[11px] font-medium text-slate-600",children:"Overpayment → credit"}),e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row",children:[e.jsx("input",{className:"h-9 flex-1 rounded-full border border-slate-200 bg-slate-50 px-3 text-xs outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"Liability account ID",value:$,onChange:t=>de(t.target.value)}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"h-9 w-32 rounded-full border border-slate-200 bg-slate-50 px-3 text-right text-xs outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"0.00",value:Q,onChange:t=>ue(t.target.value)})]})]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white px-4 py-4",children:[e.jsxs("div",{className:"grid gap-3 text-xs sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-medium text-slate-500 uppercase",children:"Bank amount"}),e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:y(T.bankAmount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-medium text-slate-500 uppercase",children:"Allocated"}),e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:y(T.totalAllocations)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-medium text-slate-500 uppercase",children:"Remaining"}),e.jsx("p",{className:`text-sm font-semibold ${Math.abs(T.remaining)<=Z?"text-emerald-600":"text-rose-600"}`,children:y(T.remaining)})]})]}),e.jsxs("p",{className:"mt-2 text-[11px] text-slate-500",children:["Must reconcile within ±$",Z.toFixed(2),"."]}),e.jsx("div",{className:"pt-3",children:e.jsx("button",{type:"button",onClick:qe,disabled:!T.isReady||x,className:`inline-flex w-full items-center justify-center rounded-full px-4 py-2 text-xs font-semibold shadow-sm ${!T.isReady||x?"cursor-not-allowed bg-slate-100 text-slate-400":"bg-slate-900 text-white hover:bg-black"}`,children:x?"Posting…":"Allocate"})})]})]}),C==="TRANSFER"&&e.jsxs("div",{className:"space-y-5 max-w-md",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Use a transfer when this movement is between your own accounts (for example, moving money from checking to savings)."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"From account"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",defaultValue:(P==null?void 0:P.name)||"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"To account"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"e.g. Savings, Credit card"})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{className:"inline-flex items-center rounded-full bg-sky-600 px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-sky-700",children:"Record transfer"})})]})]}),C==="EXCLUDE"&&e.jsxs("div",{className:"space-y-4 max-w-md",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Exclude this line if it's a duplicate, personal transaction, or otherwise not relevant to your business books. It will remain in the feed but won't affect your reports."}),e.jsx("div",{className:"rounded-2xl border border-rose-100 bg-rose-50 px-3 py-3 text-[11px] text-rose-700",children:"You can always undo this later from the bank feed if you exclude something by mistake."}),e.jsx("button",{type:"button",onClick:Qe,disabled:!s||s.status!=="NEW"||x,className:`inline-flex items-center rounded-full px-4 py-1.5 text-xs font-semibold ring-1 ${!s||s.status!=="NEW"||x?"cursor-not-allowed bg-slate-100 text-slate-400 ring-slate-200":"bg-white text-rose-600 ring-rose-200 hover:bg-rose-50"}`,children:"Exclude from books"})]})]})]}):ve?e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center px-8 py-10 text-center text-xs text-slate-400",children:e.jsx("p",{children:"Loading transaction…"})}):e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center px-8 py-10 text-center text-xs text-slate-400",children:e.jsx("p",{children:"Select a transaction on the left to review or create a posting."})})})]})]})})}const De=document.getElementById("bank-feed-root");De&&at.createRoot(De).render(e.jsx(nt.StrictMode,{children:e.jsx(it,{})}));
