import{c as $,j as e,R as D,r as n}from"./index-CzhvYmTl.js";const I={NEW:"bg-sky-50 text-sky-700 ring-sky-100",MATCHED:"bg-emerald-50 text-emerald-700 ring-emerald-100",CREATED:"bg-amber-50 text-amber-800 ring-amber-100",EXCLUDED:"bg-slate-50 text-slate-500 ring-slate-100"},F={NEW:"New",MATCHED:"Matched",CREATED:"Created",EXCLUDED:"Excluded"};function u(a){const i=typeof a=="number"?a:Number(a||0),g=i<0?"-":"",h=Math.abs(i).toFixed(2);return`${g}$${h}`}function T({status:a}){const i=I[a]||"bg-slate-50 text-slate-500 ring-slate-100";return e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-[11px] font-medium ring-1 ${i}`,children:F[a]||a})}function A({side:a}){const i=a==="IN";return e.jsxs("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-medium ring-1 ${i?"bg-emerald-50 text-emerald-700 ring-emerald-100":"bg-rose-50 text-rose-700 ring-rose-100"}`,children:[e.jsx("span",{className:"mr-1.5 h-1.5 w-1.5 rounded-full bg-current"}),i?"Money in":"Money out"]})}function U(){const[a,i]=n.useState([]),[g,h]=n.useState(!0),[N,y]=n.useState(null),[o,v]=n.useState(null),[B,L]=n.useState({}),[j,k]=n.useState([]),[w,E]=n.useState(!1),[S,C]=n.useState(null),[b,M]=n.useState("ALL"),[d,R]=n.useState("CREATE"),[f,x]=n.useState(null);n.useEffect(()=>{h(!0),y(null),fetch("/api/bank/accounts/",{credentials:"same-origin"}).then(s=>{if(!s.ok)throw new Error("Unable to load bank accounts.");return s.json()}).then(s=>{const c=(s.accounts||[]).map(t=>({id:t.id,name:t.name,bank_name:t.bank_name,last4:t.last4,balance:Number(t.balance||0),unreconciled:t.unreconciled||0}));i(c),!o&&c.length>0&&v(c[0].id)}).catch(s=>y(s.message)).finally(()=>h(!1))},[o]),n.useEffect(()=>{if(!o){k([]);return}E(!0),C(null),fetch(`/api/bank/accounts/${o}/transactions/`,{credentials:"same-origin"}).then(s=>{if(!s.ok)throw new Error("Unable to load transactions.");return s.json()}).then(s=>{const c=(s.transactions||[]).map(t=>({id:t.id,date:t.date,description:t.description,amount:Number(t.amount||0),status:t.status,side:t.side,posted_journal_entry:t.posted_journal_entry||null,expense_candidates:t.expense_candidates||[],invoice_candidates:t.invoice_candidates||[]}));k(c),L(s.status_counts||{}),i(t=>t.map(p=>p.id===o?{...p,balance:Number(s.balance||p.balance)}:p)),c.length>0?x(c[0].id):x(null)}).catch(s=>C(s.message)).finally(()=>E(!1))},[o]);const r=n.useMemo(()=>b==="ALL"?j:j.filter(s=>s.status===b),[j,b]);n.useEffect(()=>{if(r.length===0){x(null);return}if(!f){x(r[0].id);return}r.some(s=>s.id===f)||x(r[0].id)},[r,f]);const m=a.find(s=>s.id===o)||a[0],l=r.find(s=>s.id===f)||r[0]||null;return e.jsx("div",{className:"min-h-screen bg-slate-50 text-slate-900 font-sans",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-6 py-8",children:[e.jsxs("header",{className:"mb-6 flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold tracking-[0.18em] text-slate-400 uppercase mb-2",children:"BANK FEED"}),e.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-900 mb-1",children:"Review bank transactions"}),e.jsx("p",{className:"text-sm text-slate-500 max-w-xl",children:"Match bank activity to invoices and expenses, or create new transactions directly from your feed."})]}),e.jsxs("div",{className:"flex flex-col items-stretch gap-3 sm:items-end",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{className:"h-9 rounded-full border border-slate-200 bg-white px-3 text-xs font-medium text-slate-700 shadow-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-100",value:o??"",onChange:s=>v(s.target.value?Number(s.target.value):null),disabled:g||!a.length,children:a.map(s=>e.jsx("option",{value:s.id,children:`${s.name} ${s.last4?`••••${s.last4}`:""}`},s.id))}),e.jsx("a",{href:"/bank-feeds/import/",className:"inline-flex items-center rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-600 shadow-sm hover:bg-slate-50",children:"Import CSV"})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white px-3 py-2 text-right text-xs text-slate-500 shadow-sm",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-slate-400 mb-1",children:"Current balance (ledger)"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:m?u(m.balance):"—"})]})]})]}),N&&e.jsx("div",{className:"mb-4 rounded-2xl border border-rose-100 bg-rose-50 px-4 py-3 text-xs text-rose-600",children:N}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-[minmax(0,2.2fr)_minmax(0,3fr)]",children:[e.jsxs("section",{className:"rounded-3xl bg-white shadow-[0_18px_45px_rgba(15,23,42,0.06)] ring-1 ring-slate-100 flex flex-col min-h-[420px]",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 border-b border-slate-100 px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-[13px] font-semibold text-slate-900",children:"Imported transactions"}),e.jsx("p",{className:"text-[11px] text-slate-500",children:"Review and assign each line to keep your books up to date."})]}),e.jsx("div",{className:"flex gap-1 rounded-full bg-slate-50 p-1",children:[{key:"ALL",label:"All"},{key:"NEW",label:"New"},{key:"MATCHED",label:"Matched"},{key:"CREATED",label:"Created"},{key:"EXCLUDED",label:"Excluded"}].map(s=>e.jsx("button",{type:"button",onClick:()=>M(s.key),className:`rounded-full px-2.5 py-1 text-[11px] font-medium transition ${b===s.key?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-800"}`,children:s.label},s.key))})]}),e.jsx("div",{className:"border-b border-slate-100 px-4 py-2",children:e.jsx("input",{type:"search",placeholder:"Search description or amount",className:"h-8 w-full rounded-full border border-slate-200 bg-slate-50 px-3 text-xs text-slate-700 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",disabled:!0})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:S?e.jsx("div",{className:"flex h-full flex-col items-center justify-center px-8 py-10 text-center text-xs text-rose-500",children:e.jsx("p",{children:S})}):w?e.jsx("div",{className:"flex h-full flex-col items-center justify-center px-8 py-10 text-center text-xs text-slate-400",children:e.jsx("p",{children:"Loading transactions…"})}):r.length===0?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center px-8 py-10 text-center text-xs text-slate-400",children:[e.jsx("p",{children:"No transactions for this filter yet."}),e.jsx("p",{className:"mt-1",children:"Try switching the status filter or importing a new CSV."})]}):e.jsx("ul",{className:"divide-y divide-slate-100",children:r.map(s=>{const c=l&&s.id===l.id;return e.jsx("li",{className:`cursor-pointer px-4 py-3 text-xs transition hover:bg-slate-50 ${c?"bg-slate-50":"bg-white"}`,onClick:()=>x(s.id),children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[11px] font-medium text-slate-500",children:s.date}),e.jsx(T,{status:s.status})]}),e.jsx("p",{className:"mt-1 truncate text-[13px] font-medium text-slate-900",children:s.description})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(A,{side:s.side}),e.jsx("div",{className:`text-sm font-semibold ${s.amount>=0?"text-emerald-600":"text-rose-600"}`,children:u(s.amount)})]})]})},s.id)})})})]}),e.jsx("section",{className:"rounded-3xl bg-white shadow-[0_18px_45px_rgba(15,23,42,0.06)] ring-1 ring-slate-100 min-h-[420px] flex flex-col",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-slate-100 px-6 py-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-semibold tracking-[0.16em] text-slate-400 uppercase",children:l.date}),e.jsx("h2",{className:"mt-1 text-sm font-semibold text-slate-900",children:l.description}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-[11px] text-slate-500",children:[e.jsx(A,{side:l.side}),e.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 font-medium text-slate-500 ring-1 ring-slate-100",children:"From feed • Pending review"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-lg font-semibold ${l.amount>=0?"text-emerald-600":"text-rose-600"}`,children:u(l.amount)}),e.jsxs("div",{className:"mt-1 text-[11px] text-slate-500",children:["Status: ",e.jsx(T,{status:l.status})]})]})]})}),e.jsx("div",{className:"border-b border-slate-100 px-6",children:e.jsx("nav",{className:"flex gap-4 text-xs font-medium text-slate-500",children:[{key:"CREATE",label:"Create"},{key:"MATCH",label:"Match"},{key:"TRANSFER",label:"Transfer"},{key:"EXCLUDE",label:"Exclude"}].map(s=>e.jsxs("button",{type:"button",onClick:()=>R(s.key),className:`relative py-3 transition ${d===s.key?"text-slate-900":"text-slate-500 hover:text-slate-800"}`,children:[s.label,d===s.key&&e.jsx("span",{className:"absolute inset-x-0 -bottom-px block h-[2px] rounded-full bg-sky-500"})]},s.key))})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 text-sm",children:[d==="CREATE"&&e.jsxs("div",{className:"space-y-5 max-w-md",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Turn this bank line into a new expense or income entry. Mini-Books will post it to the right accounts in your ledger."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Transaction type"}),e.jsxs("div",{className:"inline-flex gap-1 rounded-full bg-slate-50 p-1 text-xs font-medium",children:[e.jsx("button",{className:"rounded-full bg-white px-3 py-1 shadow-sm text-slate-900",children:l.amount>=0?"Income":"Expense"}),e.jsx("button",{className:"rounded-full px-3 py-1 text-slate-400",disabled:!0,children:"Transfer"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Category"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:l.amount>=0?"e.g. Product sales":"e.g. Software subscriptions"})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Contact (customer or supplier)"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"Optional"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Memo"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"Internal note"})]})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{className:"inline-flex items-center rounded-full bg-emerald-600 px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-emerald-700",children:"Create & post to ledger"})})]})]}),d==="MATCH"&&l&&e.jsxs("div",{className:"space-y-5",children:[e.jsx("p",{className:"text-xs text-slate-500 max-w-md",children:"Match this bank line to an existing invoice or expense. Once matched, the payment will be reflected in your reports."}),e.jsxs("div",{className:"space-y-3 max-w-md",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Suggested matches"}),e.jsx("div",{className:"space-y-2 rounded-2xl border border-slate-100 bg-slate-50 p-3 text-xs",children:l.amount>=0?l.invoice_candidates.length>0?l.invoice_candidates.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-slate-800",children:[s.invoice_number?`Invoice #${s.invoice_number}`:"Invoice",s.customer?` · ${s.customer}`:""]}),e.jsxs("div",{className:"text-[11px] text-slate-500",children:[s.date," • ",u(s.amount)]})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"mt-1 text-[11px] font-medium text-sky-600",children:"Match"})})]},s.id)):e.jsx("div",{className:"text-[11px] text-slate-500",children:"No invoice suggestions yet."}):l.expense_candidates.length>0?l.expense_candidates.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-800",children:s.description||"Expense"}),e.jsxs("div",{className:"text-[11px] text-slate-500",children:[s.date," • ",u(s.amount)]})]}),e.jsx("div",{className:"text-right",children:e.jsx("button",{className:"mt-1 text-[11px] font-medium text-sky-600",children:"Match"})})]},s.id)):e.jsx("div",{className:"text-[11px] text-slate-500",children:"No expense suggestions yet."})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Search by invoice or expense"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"Start typing a customer, invoice #, or amount",disabled:!0})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{className:"inline-flex items-center rounded-full bg-slate-900 px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-black",children:"Confirm match"})})]})]}),d==="TRANSFER"&&e.jsxs("div",{className:"space-y-5 max-w-md",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Use a transfer when this movement is between your own accounts (for example, moving money from checking to savings)."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"From account"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",defaultValue:m==null?void 0:m.name,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"To account"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"e.g. Savings, Credit card"})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{className:"inline-flex items-center rounded-full bg-sky-600 px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-sky-700",children:"Record transfer"})})]})]}),d==="EXCLUDE"&&e.jsxs("div",{className:"space-y-4 max-w-md",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Exclude this line if it's a duplicate, personal transaction, or otherwise not relevant to your business books. It will remain in the feed but won't affect your reports."}),e.jsx("div",{className:"rounded-2xl border border-rose-100 bg-rose-50 px-3 py-3 text-[11px] text-rose-700",children:"You can always undo this later from the bank feed if you exclude something by mistake."}),e.jsx("button",{className:"inline-flex items-center rounded-full bg-white px-4 py-1.5 text-xs font-semibold text-rose-600 ring-1 ring-rose-200 hover:bg-rose-50",children:"Exclude from books"})]})]})]}):w?e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center px-8 py-10 text-center text-xs text-slate-400",children:e.jsx("p",{children:"Loading transaction…"})}):e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center px-8 py-10 text-center text-xs text-slate-400",children:e.jsx("p",{children:"Select a transaction on the left to review or create a posting."})})})]})]})})}const _=document.getElementById("bank-feed-root");_&&$.createRoot(_).render(e.jsx(D.StrictMode,{children:e.jsx(U,{})}));
