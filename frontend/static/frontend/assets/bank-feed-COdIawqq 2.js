import{c as ks,j as e,R as Es,r as a}from"./index-BH7PkO1S.js";const Cs={NEW:"bg-sky-50 text-sky-700 ring-sky-100",PARTIAL:"bg-amber-50 text-amber-800 ring-amber-100",MATCHED_SINGLE:"bg-emerald-50 text-emerald-700 ring-emerald-100",MATCHED_MULTI:"bg-emerald-50 text-emerald-700 ring-emerald-100",EXCLUDED:"bg-slate-50 text-slate-500 ring-slate-100"},Ss={NEW:"New",PARTIAL:"Partial",MATCHED_SINGLE:"Matched",MATCHED_MULTI:"Matched (multi)",EXCLUDED:"Excluded"};function p(b){const N=typeof b=="number"?b:Number(b||0),$=N<0?"-":"",j=Math.abs(N).toFixed(2);return`${$}$${j}`}function As(b){if(typeof document>"u")return null;const N=document.cookie?document.cookie.split(";"):[];for(const $ of N){const j=$.trim();if(j.startsWith(`${b}=`))return decodeURIComponent(j.substring(b.length+1))}return null}function Wt({status:b}){const N=Cs[b]||"bg-slate-50 text-slate-500 ring-slate-100";return e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-[11px] font-medium ring-1 ${N}`,children:Ss[b]||b})}function Gt({side:b}){const N=b==="IN";return e.jsxs("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-medium ring-1 ${N?"bg-emerald-50 text-emerald-700 ring-emerald-100":"bg-rose-50 text-rose-700 ring-rose-100"}`,children:[e.jsx("span",{className:"mr-1.5 h-1.5 w-1.5 rounded-full bg-current"}),N?"Money in":"Money out"]})}function _e(b,N,$){const j=Number(b||0),K=Number($||0)/100,C=h=>Math.round(h*100)/100;if(!Number.isFinite(j))return{net:0,tax:0,gross:0};if(N==="INCLUDED"){const h=j,_=1+K,v=_===0?h:h/_,de=h-v;return{net:C(v),tax:C(de),gross:C(h)}}if(N==="ON_TOP"){const h=j,_=h*K,v=h+_;return{net:C(h),tax:C(_),gross:C(v)}}return{net:C(j),tax:0,gross:C(j)}}function Is(){var $t,Ft;const[b,N]=a.useState([]),[$,j]=a.useState(!0),[K,C]=a.useState(null),[h,_]=a.useState(null),[v,de]=a.useState({}),[De,pt]=a.useState([]),[bt,Me]=a.useState(!1),[ht,Oe]=a.useState(null),[Le,qt]=a.useState([]),[Re,zt]=a.useState([]),[k,Yt]=a.useState([]),[E,Jt]=a.useState([]),[D,Kt]=a.useState([]),[u,Qt]=a.useState([]),[Pe,Zt]=a.useState([]),[Ue,es]=a.useState([]),[Q,ft]=a.useState(!0),[gt,yt]=a.useState(null),[G,ts]=a.useState("ALL"),[F,ss]=a.useState("ALLOCATE"),[xe,B]=a.useState(null),[ue,Z]=a.useState(""),[ee,me]=a.useState(""),[Nt,$e]=a.useState(""),[V,Fe]=a.useState("NONE"),[te,Be]=a.useState(""),[pe,f]=a.useState(null),[be,S]=a.useState(null),[g,M]=a.useState(!1),[H,he]=a.useState({}),[q,se]=a.useState([]),[ae,Ve]=a.useState(""),[fe,Xe]=a.useState(""),[ne,We]=a.useState(""),[ge,Ge]=a.useState(""),[le,He]=a.useState(""),[ye,qe]=a.useState(""),[w,ze]=a.useState("IN"),[z,Ne]=a.useState(""),[Ye,Je]=a.useState(""),[Y,jt]=a.useState("NONE"),[oe,vt]=a.useState(""),[wt,kt]=a.useState(""),[je,Ke]=a.useState(""),[as,re]=a.useState(!1),[ns,ve]=a.useState(!1),[m,X]=a.useState({name:"",type:"EXPENSE",code:"",description:"",accountId:""}),[Et,Qe]=a.useState(null),[Ze,Ct]=a.useState(!1),[ls,we]=a.useState(!1),[ke,et]=a.useState("IN"),[tt,St]=a.useState(""),[Ee,st]=a.useState(""),[Ce,at]=a.useState(""),[nt,lt]=a.useState(""),[At,J]=a.useState(null),[ot,It]=a.useState(!1),Tt=a.useMemo(()=>As("csrftoken"),[]),O=a.useCallback(async()=>{j(!0),C(null);try{const t=await fetch("/api/banking/overview/",{credentials:"same-origin"});if(!t.ok)throw new Error("Unable to load bank accounts.");const l=((await t.json()).accounts||[]).map(o=>({id:o.id,name:o.name,last4:o.last4||"",ledgerBalance:Number(o.ledger_balance||0),ledgerAccountId:o.ledger_account_id??o.account_id??null,currency:o.currency||"USD"}));N(l),_(o=>{var c;return o&&l.some(r=>r.id===o)?o:((c=l[0])==null?void 0:c.id)??null})}catch(t){C(t instanceof Error?t.message:"Unable to load bank accounts.")}finally{j(!1)}},[]);a.useEffect(()=>{O()},[O]);const L=a.useCallback(async()=>{if(!h){pt([]),de({}),B(null),Oe(null),Me(!1);return}Me(!0),Oe(null);const t=new URLSearchParams;t.set("account_id",String(h)),t.set("status",G);try{const n=await fetch(`/api/banking/feed/transactions/?${t.toString()}`,{credentials:"same-origin"});if(!n.ok)throw new Error("Unable to load transactions.");const l=await n.json(),o=(l.transactions||[]).map(x=>({id:x.id,date:x.date,description:x.description,amount:Number(x.amount||0),status:x.status,statusLabel:x.status_label||x.status,side:x.side,allocatedAmount:Number(x.allocated_amount||0),posted_journal_entry:x.posted_journal_entry||null,expense_candidates:x.expense_candidates||[],invoice_candidates:x.invoice_candidates||[]}));pt(o),de({NEW:0,PARTIAL:0,MATCHED_SINGLE:0,MATCHED_MULTI:0,EXCLUDED:0,...l.status_counts||{}});const c=l.account||{},r=Number(c.ledger_balance??l.balance??0);N(x=>x.map(y=>y.id===h?{...y,ledgerBalance:r,ledgerAccountId:c.ledger_account_id??y.ledgerAccountId??null,currency:c.currency||y.currency}:y)),o.length>0?B(x=>x&&o.some(y=>y.id===x)?x:o[0].id):B(null)}catch(n){Oe(n instanceof Error?n.message:"Unable to load transactions.")}finally{Me(!1)}},[h,G]);a.useEffect(()=>{L()},[L]),a.useEffect(()=>{re(!1)},[h]);const R=a.useCallback(async(t,n)=>{const l=await fetch(t,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRFToken":Tt||""},body:JSON.stringify(n||{})});if(!l.ok){let o="Unable to complete action.";try{const c=await l.json();o=(c==null?void 0:c.detail)||(c==null?void 0:c.error)||o}catch{}throw new Error(o)}try{return await l.json()}catch{return{}}},[Tt]),I=a.useMemo(()=>G==="ALL"?De:De.filter(t=>t.status===G),[De,G]);a.useEffect(()=>{if(I.length===0){B(null);return}if(!xe){B(I[0].id);return}I.some(t=>t.id===xe)||B(I[0].id)},[I,xe]);const d=b.find(t=>t.id===h)||null,os=(d==null?void 0:d.currency)||"USD",Se=a.useCallback(async()=>{ft(!0),yt(null);try{const t=await fetch("/api/banking/feed/metadata/",{credentials:"same-origin"});if(!t.ok)throw new Error("Unable to load categories.");const n=await t.json();qt(n.expense_categories||[]),zt(n.income_categories||[]),Zt(n.suppliers||[]),es(n.customers||[]),Yt(n.expense_accounts||[]),Jt(n.income_accounts||[]),Kt(n.equity_accounts||[]),Qt((n.tax_rates||[]).map(l=>({id:l.id,name:l.name,code:l.code,percentage:Number(l.percentage||0)})))}catch(t){yt(t instanceof Error?t.message:"Unable to load categories.")}finally{ft(!1)}},[]);a.useEffect(()=>{Se()},[Se]),a.useEffect(()=>{const t=w==="IN"?E:[...k,...D];t.length!==0&&(t.some(n=>String(n.id)===z)||Ne(String(t[0].id)))},[w,E,k,D,z]);const s=I.find(t=>t.id===xe)||I[0]||null;a.useEffect(()=>{var o,c,r;if(!s){Z(""),me(""),Ne(""),Je(""),Ke(""),Fe("NONE"),Be("");return}const t=s.side==="OUT"?Le:Re;t.length>0?Z(x=>x&&t.some(y=>String(y.id)===x)?x:String(t[0].id)):Z(""),me(""),he({}),se([]),Ve(""),Xe(""),We(""),Ge(""),He(""),qe(""),Fe("NONE"),Be((o=u[0])!=null&&o.id?String(u[0].id):"");const n=s.side==="IN"?"IN":"OUT";ze(n);const l=n==="IN"?E:[...k,...D];Ne((c=l[0])!=null&&c.id?String(l[0].id):""),Je(Math.abs(s.amount||0).toFixed(2)),jt("NONE"),vt((r=u[0])!=null&&r.id?String(u[0].id):""),kt(s.description||""),Ke("")},[s==null?void 0:s.id,Le,Re,D,u]),a.useEffect(()=>{$e(""),f(null),S(null)},[s==null?void 0:s.id]);const rt=s&&s.side==="OUT"?Le:Re,_t=s&&s.side==="OUT"?Pe:Ue,rs=s&&s.side==="OUT"?"Supplier":"Customer",Dt=!!(s&&ue),it=(($t=u.find(t=>String(t.id)===te))==null?void 0:$t.percentage)||0,Mt=s&&V==="ON_TOP"&&it>0?(Math.abs(s.amount||0)/(1+it/100)).toFixed(2):s?Math.abs(s.amount||0).toFixed(2):"0",Ae=_e(Mt,V,it),Ie=s?Math.abs(Ae.gross-Math.abs(s.amount||0))<=.02:!1,ct=a.useMemo(()=>w==="IN"?E:[...k,...D],[w,k,E,D]),is=((Ft=u.find(t=>String(t.id)===oe))==null?void 0:Ft.percentage)||0,Te=_e(Ye||"0",Y,is),dt=s?Math.abs(s.amount||0):0,Ot=Math.abs(Te.gross-dt)<=.02,Lt=!!(s&&z)&&Ot&&!g,cs=[{key:"ALL",label:"All",count:a.useMemo(()=>Object.keys(v).reduce((t,n)=>t+Number(v[n]||0),0),[v])},{key:"NEW",label:"New",count:v.NEW??0},{key:"PARTIAL",label:"Partial",count:v.PARTIAL??0},{key:"MATCHED_SINGLE",label:"Matched",count:v.MATCHED_SINGLE??0},{key:"MATCHED_MULTI",label:"Matched (multi)",count:v.MATCHED_MULTI??0},{key:"EXCLUDED",label:"Excluded",count:v.EXCLUDED??0}],W=(s==null?void 0:s.side)==="IN",Rt=s?W?s.invoice_candidates:s.expense_candidates:[],Pt=2,xt=Pt/100,A=a.useCallback(t=>{if(typeof t!="string")return 0;const n=Number(t);return Number.isFinite(n)?n:0},[]),Ut=a.useCallback(()=>{var l;const t=(s==null?void 0:s.side)==="OUT"?"EXPENSE":"INCOME",n=t==="EXPENSE"?k:E;X({name:"",type:t,code:"",description:"",accountId:(l=n[0])!=null&&l.id?String(n[0].id):""}),Qe(null),ve(!0),re(!1)},[k,E,s==null?void 0:s.side]),ds=a.useCallback(async()=>{Ct(!0),Qe(null);const t={name:m.name,type:m.type,code:m.code,description:m.description,account_id:m.accountId?Number(m.accountId):null};try{const n=await R("/api/categories/",t),l=n==null?void 0:n.category;if(await Se(),l&&s){const o=s.side==="OUT"?"EXPENSE":"INCOME";l.type===o&&Z(String(l.id))}ve(!1),f(null),S("Category created and ready to use.")}catch(n){Qe(n instanceof Error?n.message:"Unable to create category.")}finally{Ct(!1)}},[m.accountId,m.code,m.description,m.name,m.type,Se,R,s]),xs=a.useCallback(()=>{const t=(s==null?void 0:s.side)||"IN";et(t),St((s==null?void 0:s.date)||new Date().toISOString().slice(0,10)),st(""),at(""),lt(""),J(null),we(!0),re(!1)},[s]),us=a.useCallback(async()=>{if(!d||!d.ledgerAccountId){J("Link this bank account to a ledger account before creating a transaction.");return}const t=Number(Ee);if(!Ee||!Number.isFinite(t)||t===0){J("Enter a non-zero amount.");return}if(!Ce.trim()){J("Add a description before saving.");return}It(!0),J(null);const n={date:tt,amount:Math.abs(t),description:Ce.trim(),memo:nt.trim(),side:ke};try{await R(`/api/accounts/${d.ledgerAccountId}/manual-transaction/`,n),f(null),S("Transaction added to your feed."),we(!1),st(""),at(""),lt(""),await Promise.all([L(),O()])}catch(l){J(l instanceof Error?l.message:"Unable to create transaction.")}finally{It(!1)}},[d,O,L,R,Ee,tt,Ce,nt,ke]),ms=a.useCallback((t,n)=>{he(l=>{const o={...l};return n?o[t.id]=t.amount.toFixed(2):delete o[t.id],o})},[]),ps=a.useCallback((t,n)=>{he(l=>({...l,[t]:n}))},[]),bs=a.useCallback(()=>{if(!s)return;const t=`manual-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,n=s.side==="IN"?"DIRECT_INCOME":"DIRECT_EXPENSE",l=n==="DIRECT_INCOME"?E:[...k,...D];se(o=>{var c,r;return[...o,{key:t,type:n,accountId:(c=l[0])!=null&&c.id?String(l[0].id):"",amount:"",taxTreatment:"NONE",taxRateId:(r=u[0])!=null&&r.id?String(u[0].id):""}]})},[s,k,E,D,u]),ie=a.useCallback((t,n)=>{se(l=>l.map(o=>o.key===t?{...o,...n}:o))},[]),hs=a.useCallback(t=>{se(n=>n.filter(l=>l.key!==t))},[]),P=a.useMemo(()=>{if(!s)return{bankAmount:0,totalAllocations:0,candidateTotal:0,manualTotal:0,feeValue:0,roundingValue:0,overpaymentValue:0,expectedBank:0,remaining:0,allocationCount:0,isReady:!1};const t=T=>{if(!T.taxRateId)return 0;const U=u.find(mt=>String(mt.id)===T.taxRateId);return U?U.percentage:0},n=Object.values(H).reduce((T,U)=>T+A(U),0),l=q.reduce((T,U)=>{const mt=_e(U.amount,U.taxTreatment||"NONE",t(U));return T+mt.gross},0),o=n+l,c=A(fe),r=Number(ge),x=Number.isFinite(r)?r:0,y=A(ye),ce=Math.abs(s.amount),i=W?o+y-c-x:o+c+x,ut=ce-i,Bt=Object.keys(H).length+q.filter(T=>A(T.amount)>0&&T.accountId).length,js=c>0,vs=x!==0,ws=y>0,Vt=o>0&&Bt>0,Xt=(!js||!!ae)&&(!vs||!!ne)&&(!ws||!!le&&W);return{bankAmount:ce,totalAllocations:o,candidateTotal:n,manualTotal:l,feeValue:c,roundingValue:x,overpaymentValue:y,expectedBank:i,remaining:ut,allocationCount:Bt,hasAllocations:Vt,hasRequiredAccounts:Xt,isReady:Vt&&Xt}},[H,q,fe,ge,ye,ae,ne,le,A,s,W]),fs=async()=>{if(!s||!ue){f("Select a category before posting this entry.");return}if(!Ie){f("Tax selection must match the bank amount.");return}if(V!=="NONE"&&!te){f("Select a tax code for this tax treatment.");return}M(!0),f(null),S(null);const t={category_id:Number(ue),memo:Nt,tax_treatment:V,amount:Mt};V!=="NONE"&&te&&(t.tax_rate_id=Number(te)),s.side==="OUT"&&ee&&(t.supplier_id=Number(ee)),s.side==="IN"&&ee&&(t.customer_id=Number(ee));try{await R(`/api/banking/feed/transactions/${s.id}/create/`,t),S("Entry posted to the ledger."),$e(""),me(""),await Promise.all([L(),O()])}catch(n){f(n instanceof Error?n.message:"Unable to post this entry.")}finally{M(!1)}},gs=async()=>{if(!s)return;const t=s.side==="IN",n=Object.entries(H).map(([i,ut])=>({id:Number(i),amountValue:A(ut)})).filter(i=>i.amountValue>0).map(i=>({type:t?"INVOICE":"BILL",id:i.id,amount:i.amountValue.toFixed(2)})),l=q.map(i=>({type:i.type,account_id:i.accountId?Number(i.accountId):null,amountValue:A(i.amount),tax_treatment:i.taxTreatment||"NONE",tax_rate_id:i.taxRateId?Number(i.taxRateId):null})).filter(i=>i.account_id&&i.amountValue>0).map(i=>({type:i.type,account_id:i.account_id,amount:i.amountValue.toFixed(2),tax_treatment:i.tax_treatment,tax_rate_id:i.tax_rate_id||void 0})),o=[...n,...l];if(o.length===0){f("Add at least one allocation amount.");return}const c={allocations:o,tolerance_cents:Pt,operation_id:`banktx-${s.id}-${Date.now()}`},r=A(fe);ae&&r>0&&(c.fees={account_id:Number(ae),amount:r.toFixed(2)});const x=Number(ge),y=Number.isFinite(x)?x:0;ne&&y!==0&&(c.rounding={account_id:Number(ne),amount:y.toFixed(2)});const ce=A(ye);t&&le&&ce>0&&(c.overpayment={account_id:Number(le),amount:ce.toFixed(2)}),M(!0),f(null),S(null);try{const i=await R(`/api/banking/transactions/${s.id}/allocate/`,c);if(!(i!=null&&i.ok))throw new Error((i==null?void 0:i.error)||"Unable to allocate this transaction.");S("Allocation posted to the ledger."),he({}),se([]),Ve(""),Xe(""),We(""),Ge(""),He(""),qe(""),await Promise.all([L(),O()])}catch(i){f(i instanceof Error?i.message:"Unable to allocate this transaction.")}finally{M(!1)}},ys=async()=>{if(!s||!z)return;const t=A(Ye);if(t<=0){f("Enter an amount greater than zero.");return}if(Y!=="NONE"&&!oe){f("Select a tax code for this tax treatment.");return}M(!0),f(null),S(null);const n={account_id:Number(z),direction:w,amount:t.toFixed(2),tax_treatment:Y,memo:wt.trim()};Y!=="NONE"&&oe&&(n.tax_rate_id=Number(oe)),je&&(w==="IN"?n.customer_id=Number(je):n.supplier_id=Number(je));try{const l=await R(`/api/banking/feed/transactions/${s.id}/add/`,n);if(!(l!=null&&l.success))throw new Error((l==null?void 0:l.detail)||(l==null?void 0:l.error)||"Unable to post entry.");S("Posted to the ledger and reconciled."),await Promise.all([L(),O()])}catch(l){f(l instanceof Error?l.message:"Unable to post this entry.")}finally{M(!1)}},Ns=async()=>{if(s){M(!0),f(null),S(null);try{await R(`/api/banking/feed/transactions/${s.id}/exclude/`),S("Transaction excluded from review."),await Promise.all([L(),O()])}catch(t){f(t instanceof Error?t.message:"Unable to exclude this transaction.")}finally{M(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen bg-slate-50 text-slate-900 font-sans",children:e.jsxs("div",{className:"mx-auto max-w-6xl px-6 py-8",children:[e.jsxs("header",{className:"mb-6 flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold tracking-[0.18em] text-slate-400 uppercase mb-2",children:"BANK FEED"}),e.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-900 mb-1",children:"Review bank transactions"}),e.jsx("p",{className:"text-sm text-slate-500 max-w-xl",children:"Match bank activity to invoices and expenses, or create new transactions directly from your feed."})]}),e.jsxs("div",{className:"flex flex-col items-stretch gap-3 sm:items-end",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:justify-end",children:[e.jsx("select",{className:"h-9 rounded-full border border-slate-200 bg-white px-3 text-xs font-medium text-slate-700 shadow-sm focus:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-100",value:h??"",onChange:t=>_(t.target.value?Number(t.target.value):null),disabled:$||!b.length,children:b.map(t=>e.jsx("option",{value:t.id,children:`${t.name}${t.last4?` ••••${t.last4}`:""}`},t.id))}),e.jsx("a",{href:"/bank-feeds/new/",className:"inline-flex items-center rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-600 shadow-sm hover:bg-slate-50",children:"Import CSV"}),e.jsxs("div",{className:"relative",onMouseLeave:()=>re(!1),children:[e.jsx("button",{type:"button",onClick:()=>re(t=>!t),className:"inline-flex items-center rounded-full bg-slate-900 px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-black",children:"+ Create"}),as&&e.jsxs("div",{className:"absolute right-0 z-20 mt-1 w-48 rounded-2xl border border-slate-200 bg-white p-1 text-left shadow-lg",children:[e.jsxs("button",{type:"button",onClick:Ut,className:"flex w-full items-center justify-between rounded-xl px-3 py-2 text-[11px] font-medium text-slate-700 hover:bg-slate-50",children:[e.jsx("span",{children:"New category"}),e.jsx("span",{className:"text-slate-400",children:"⌘C"})]}),e.jsxs("button",{type:"button",onClick:xs,disabled:!(d!=null&&d.ledgerAccountId),className:`flex w-full items-center justify-between rounded-xl px-3 py-2 text-[11px] font-medium ${d!=null&&d.ledgerAccountId?"text-slate-700 hover:bg-slate-50":"cursor-not-allowed text-slate-300"}`,children:[e.jsx("span",{children:"New transaction"}),e.jsx("span",{className:"text-slate-400",children:"⌘T"})]}),!(d!=null&&d.ledgerAccountId)&&e.jsx("p",{className:"px-3 pb-2 text-[10px] text-slate-400",children:"Link this bank to a ledger account to post manual transactions."})]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white px-3 py-2 text-right text-xs text-slate-500 shadow-sm",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-slate-400 mb-1",children:"Current balance (ledger)"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:d?p(d.ledgerBalance):"—"})]})]})]}),K&&e.jsx("div",{className:"mb-4 rounded-2xl border border-rose-100 bg-rose-50 px-4 py-3 text-xs text-rose-600",children:K}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-[minmax(0,2.2fr)_minmax(0,3fr)]",children:[e.jsxs("section",{className:"rounded-3xl bg-white shadow-[0_18px_45px_rgba(15,23,42,0.06)] ring-1 ring-slate-100 flex flex-col min-h-[420px]",children:[e.jsxs("div",{className:"flex flex-col gap-3 border-b border-slate-100 px-4 py-3 sm:flex-row sm:items-center sm:justify-between sm:gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-shrink-0",children:[e.jsx("h2",{className:"text-[13px] font-semibold text-slate-900",children:"Imported transactions"}),e.jsx("p",{className:"text-[11px] text-slate-500",children:"Review and assign each line to keep your books up to date."})]}),e.jsx("div",{className:"w-full flex-1 sm:w-auto",children:e.jsx("div",{className:"flex max-w-full flex-wrap items-center gap-1 overflow-x-auto rounded-2xl bg-slate-50 p-2 sm:flex-nowrap sm:justify-end sm:rounded-full sm:p-1 sm:pl-2",children:cs.map(t=>e.jsxs("button",{type:"button",onClick:()=>ts(t.key),className:`flex-shrink-0 rounded-full px-2.5 py-1 text-[11px] font-medium transition ${G===t.key?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-800"}`,children:[e.jsx("span",{children:t.label}),e.jsx("span",{className:"ml-1 text-[10px] font-semibold text-slate-400",children:t.count??0})]},t.key))})})]}),e.jsx("div",{className:"border-b border-slate-100 px-4 py-2",children:e.jsx("input",{type:"search",placeholder:"Search description or amount",className:"h-8 w-full rounded-full border border-slate-200 bg-slate-50 px-3 text-xs text-slate-700 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",disabled:!0})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:ht?e.jsx("div",{className:"flex h-full flex-col items-center justify-center px-8 py-10 text-center text-xs text-rose-500",children:e.jsx("p",{children:ht})}):bt?e.jsx("div",{className:"flex h-full flex-col items-center justify-center px-8 py-10 text-center text-xs text-slate-400",children:e.jsx("p",{children:"Loading transactions…"})}):I.length===0?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center px-8 py-10 text-center text-xs text-slate-400",children:[e.jsx("p",{children:"No transactions for this filter yet."}),e.jsx("p",{className:"mt-1",children:"Try switching the status filter or importing a new CSV."})]}):e.jsx("ul",{className:"divide-y divide-slate-100",children:I.map(t=>{const n=s&&t.id===s.id;return e.jsx("li",{className:`cursor-pointer px-4 py-3 text-xs transition hover:bg-slate-50 ${n?"bg-slate-50":"bg-white"}`,onClick:()=>B(t.id),children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[11px] font-medium text-slate-500",children:t.date}),e.jsx(Wt,{status:t.status})]}),e.jsx("p",{className:"mt-1 truncate text-[13px] font-medium text-slate-900",children:t.description})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(Gt,{side:t.side}),e.jsx("div",{className:`text-sm font-semibold ${t.amount>=0?"text-emerald-600":"text-rose-600"}`,children:p(t.amount)})]})]})},t.id)})})})]}),e.jsx("section",{className:"rounded-3xl bg-white shadow-[0_18px_45px_rgba(15,23,42,0.06)] ring-1 ring-slate-100 min-h-[420px] flex flex-col",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-b border-slate-100 px-6 py-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-semibold tracking-[0.16em] text-slate-400 uppercase",children:s.date}),e.jsx("h2",{className:"mt-1 text-sm font-semibold text-slate-900",children:s.description}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-[11px] text-slate-500",children:[e.jsx(Gt,{side:s.side}),e.jsx("span",{className:"inline-flex items-center rounded-full bg-slate-50 px-2 py-0.5 font-medium text-slate-500 ring-1 ring-slate-100",children:"Bank feed"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-lg font-semibold ${s.amount>=0?"text-emerald-600":"text-rose-600"}`,children:p(s.amount)}),e.jsxs("div",{className:"mt-1 flex items-center justify-end gap-2 text-[11px] text-slate-500",children:["Status: ",e.jsx(Wt,{status:s.status})]}),e.jsxs("div",{className:"text-[11px] text-slate-500",children:["Allocated: ",p(s.allocatedAmount)]})]})]})}),e.jsx("div",{className:"border-b border-slate-100 px-6",children:e.jsx("nav",{className:"flex gap-4 text-xs font-medium text-slate-500",children:[{key:"ALLOCATE",label:"Allocate"},{key:"CREATE",label:"Create"},{key:"ADD",label:"Add to bank account"},{key:"TRANSFER",label:"Transfer"},{key:"EXCLUDE",label:"Exclude"}].map(t=>e.jsxs("button",{type:"button",onClick:()=>ss(t.key),className:`relative py-3 transition ${F===t.key?"text-slate-900":"text-slate-500 hover:text-slate-800"}`,children:[t.label,F===t.key&&e.jsx("span",{className:"absolute inset-x-0 -bottom-px block h-[2px] rounded-full bg-sky-500"})]},t.key))})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-4 text-sm",children:[pe&&e.jsx("div",{className:"mb-3 rounded-2xl border border-rose-100 bg-rose-50 px-3 py-2 text-[11px] text-rose-600",children:pe}),be&&e.jsx("div",{className:"mb-3 rounded-2xl border border-emerald-100 bg-emerald-50 px-3 py-2 text-[11px] text-emerald-700",children:be}),F==="CREATE"&&e.jsxs("div",{className:"space-y-5 max-w-md",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Turn this bank line into a new expense or income entry. Mini-Books will post it to the right accounts in your ledger."}),gt&&e.jsx("div",{className:"rounded-2xl border border-rose-100 bg-rose-50 px-3 py-2 text-[11px] text-rose-600",children:gt}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Transaction type"}),e.jsxs("div",{className:"inline-flex gap-1 rounded-full bg-slate-50 p-1 text-xs font-medium",children:[e.jsx("button",{className:"rounded-full bg-white px-3 py-1 shadow-sm text-slate-900",children:s.amount>=0?"Income":"Expense"}),e.jsx("button",{className:"rounded-full px-3 py-1 text-slate-400",disabled:!0,children:"Transfer"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between",children:[e.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Category"}),e.jsx("button",{type:"button",onClick:Ut,className:"text-[11px] font-semibold text-sky-600 hover:text-sky-700",disabled:Q,children:"Create"})]}),e.jsx("select",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-white px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100 disabled:cursor-not-allowed disabled:bg-slate-100",value:ue,onChange:t=>Z(t.target.value),disabled:Q||rt.length===0||g,children:rt.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))}),!Q&&rt.length===0&&e.jsxs("p",{className:"mt-1 text-[11px] text-rose-500",children:["Add ",s.amount>=0?"income":"expense"," categories to your chart of accounts to post directly from the feed."]})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:[rs," (optional)"]}),e.jsxs("select",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-white px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100 disabled:cursor-not-allowed disabled:bg-slate-100",value:ee,onChange:t=>me(t.target.value),disabled:g||_t.length===0,children:[e.jsx("option",{value:"",children:s.side==="OUT"?"No supplier":"No customer"}),_t.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Memo"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"Internal note",value:Nt,onChange:t=>$e(t.target.value),disabled:g})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 px-3 py-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("select",{value:V,onChange:t=>Fe(t.target.value),className:"h-9 rounded-full border border-slate-200 bg-white px-3 text-xs outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100",children:[e.jsx("option",{value:"NONE",children:"No tax"}),e.jsx("option",{value:"INCLUDED",children:"Tax included"}),e.jsx("option",{value:"ON_TOP",children:"Tax on top"})]}),e.jsx("select",{value:te,onChange:t=>Be(t.target.value),disabled:V==="NONE"||u.length===0,className:"h-9 rounded-full border border-slate-200 bg-white px-3 text-xs outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100 disabled:bg-slate-100",children:u.length===0?e.jsx("option",{value:"",children:"No tax codes"}):u.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.percentage,"%)"]},t.id))}),e.jsxs("span",{className:"text-[11px] text-slate-600",children:["Net ",p(Ae.net)," · Tax ",p(Ae.tax)," · Gross"," ",p(Ae.gross)]})]}),!Ie&&e.jsxs("p",{className:"mt-1 text-[11px] text-rose-600",children:["Gross must match the bank amount (",p(Math.abs(s.amount||0)),")."]})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"button",onClick:fs,disabled:!Dt||g||Q||!Ie,className:`inline-flex items-center rounded-full px-4 py-1.5 text-xs font-semibold text-white shadow-sm ${!Dt||g||Q||!Ie?"cursor-not-allowed bg-emerald-400":"bg-emerald-600 hover:bg-emerald-700"}`,children:g?"Posting…":"Create & post to ledger"})})]})]}),F==="ALLOCATE"&&s&&e.jsxs("div",{className:"space-y-5",children:[be&&e.jsx("div",{className:"rounded-2xl border border-emerald-100 bg-emerald-50 px-3 py-2 text-[11px] text-emerald-700",children:be}),pe&&e.jsx("div",{className:"rounded-2xl border border-rose-100 bg-rose-50 px-3 py-2 text-[11px] text-rose-600",children:pe}),e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-slate-50 px-4 py-4",children:[e.jsx("div",{className:"mb-3 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-[11px] font-semibold text-slate-500 uppercase",children:["Suggested ",W?"invoices":"bills"]}),e.jsx("p",{className:"text-[11px] text-slate-500",children:"Select which documents this bank line belongs to."})]})}),e.jsx("div",{className:"space-y-3",children:Rt.length?Rt.map(t=>{const n=Object.prototype.hasOwnProperty.call(H,t.id),l=H[t.id]||"";return e.jsx("div",{className:"rounded-xl bg-white px-3 py-2 text-xs text-slate-700 shadow-sm",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500",checked:n,onChange:o=>ms(t,o.target.checked)}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-slate-900",children:[t.invoice_number?`Invoice #${t.invoice_number}`:t.description||(W?"Invoice":"Bill"),t.customer?` · ${t.customer}`:""]}),e.jsxs("div",{className:"text-[11px] text-slate-500",children:[t.date," • ",p(t.amount)]})]})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"h-9 w-32 rounded-full border border-slate-200 bg-white px-3 text-right text-xs text-slate-800 outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100 disabled:bg-slate-100",value:l,disabled:!n,onChange:o=>ps(t.id,o.target.value)})]})},t.id)}):e.jsx("p",{className:"text-[11px] text-slate-500",children:"No suggestions yet."})})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white px-4 py-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-semibold text-slate-500 uppercase",children:"Additional splits"}),e.jsx("p",{className:"text-[11px] text-slate-500",children:"Send part of the amount directly to ledger accounts."})]}),e.jsx("button",{type:"button",onClick:bs,className:"inline-flex items-center rounded-full bg-slate-900 px-3 py-1 text-[11px] font-semibold text-white shadow-sm hover:bg-black",children:"+ Add split"})]}),e.jsxs("div",{className:"space-y-3 text-xs",children:[q.length===0&&e.jsx("p",{className:"text-[11px] text-slate-500",children:"No manual splits yet."}),q.map(t=>{var c;const n=((c=u.find(r=>String(r.id)===t.taxRateId))==null?void 0:c.percentage)||0,l=_e(t.amount,t.taxTreatment||"NONE",n),o=s.side==="IN"?[{value:"DIRECT_INCOME",label:"Direct income"}]:[{value:"DIRECT_EXPENSE",label:"Direct expense"}];return e.jsxs("div",{className:"rounded-xl border border-slate-100 bg-slate-50 px-3 py-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("select",{value:t.type,onChange:r=>ie(t.key,{type:r.target.value}),className:"h-9 rounded-full border border-slate-200 bg-white px-3 text-xs outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100",disabled:o.length===1,children:o.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),e.jsx("input",{className:"h-9 flex-1 rounded-full border border-slate-200 bg-white px-3 text-xs outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100",placeholder:"Account ID",value:t.accountId,onChange:r=>ie(t.key,{accountId:r.target.value})}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"h-9 w-28 rounded-full border border-slate-200 bg-white px-3 text-right text-xs outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100",placeholder:"Amount",value:t.amount,onChange:r=>ie(t.key,{amount:r.target.value})}),e.jsxs("select",{value:t.taxTreatment||"NONE",onChange:r=>ie(t.key,{taxTreatment:r.target.value}),className:"h-9 rounded-full border border-slate-200 bg-white px-3 text-xs outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100",children:[e.jsx("option",{value:"NONE",children:"No tax"}),e.jsx("option",{value:"INCLUDED",children:"Tax included"}),e.jsx("option",{value:"ON_TOP",children:"Tax on top"})]}),e.jsx("select",{value:t.taxRateId,onChange:r=>ie(t.key,{taxRateId:r.target.value}),disabled:(t.taxTreatment||"NONE")==="NONE"||u.length===0,className:"h-9 rounded-full border border-slate-200 bg-white px-3 text-xs outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100 disabled:bg-slate-100",children:u.length===0?e.jsx("option",{value:"",children:"No tax codes"}):u.map(r=>e.jsxs("option",{value:r.id,children:[r.name," (",r.percentage,"%)"]},r.id))}),e.jsx("button",{type:"button",onClick:()=>hs(t.key),className:"text-[11px] font-medium text-rose-500 hover:text-rose-600",children:"Remove"})]}),e.jsxs("div",{className:"mt-1 text-[11px] text-slate-600",children:["Net ",p(l.net)," · Tax ",p(l.tax)," · Gross"," ",p(l.gross)]})]},t.key)})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white px-4 py-4",children:[e.jsx("p",{className:"text-[11px] font-semibold text-slate-500 uppercase mb-3",children:"Adjustments"}),e.jsxs("div",{className:"grid gap-3 text-xs md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[11px] font-medium text-slate-600",children:"Processor fee"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:flex-nowrap",children:[e.jsx("input",{className:"h-9 min-w-[150px] flex-1 rounded-full border border-slate-200 bg-slate-50 px-3 text-xs outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"Account ID",value:ae,onChange:t=>Ve(t.target.value)}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"h-9 w-32 flex-shrink-0 rounded-full border border-slate-200 bg-slate-50 px-3 text-right text-xs outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"0.00",value:fe,onChange:t=>Xe(t.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[11px] font-medium text-slate-600",children:"Rounding"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:flex-nowrap",children:[e.jsx("input",{className:"h-9 min-w-[150px] flex-1 rounded-full border border-slate-200 bg-slate-50 px-3 text-xs outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"Account ID",value:ne,onChange:t=>We(t.target.value)}),e.jsx("input",{type:"number",step:"0.01",className:"h-9 w-32 flex-shrink-0 rounded-full border border-slate-200 bg-slate-50 px-3 text-right text-xs outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"0.00",value:ge,onChange:t=>Ge(t.target.value)})]})]}),W&&e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-[11px] font-medium text-slate-600",children:"Overpayment → credit"}),e.jsxs("div",{className:"flex flex-col flex-wrap gap-2 sm:flex-row sm:items-center",children:[e.jsx("input",{className:"h-9 min-w-[180px] flex-1 rounded-full border border-slate-200 bg-slate-50 px-3 text-xs outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"Liability account ID",value:le,onChange:t=>He(t.target.value)}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"h-9 w-32 flex-shrink-0 rounded-full border border-slate-200 bg-slate-50 px-3 text-right text-xs outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"0.00",value:ye,onChange:t=>qe(t.target.value)})]})]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white px-4 py-4",children:[e.jsxs("div",{className:"grid gap-3 text-xs sm:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-medium text-slate-500 uppercase",children:"Bank amount"}),e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:p(P.bankAmount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-medium text-slate-500 uppercase",children:"Allocated"}),e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:p(P.totalAllocations)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-medium text-slate-500 uppercase",children:"Remaining"}),e.jsx("p",{className:`text-sm font-semibold ${Math.abs(P.remaining)<=xt?"text-emerald-600":"text-rose-600"}`,children:p(P.remaining)})]})]}),e.jsx("p",{className:"mt-2 text-[11px] text-slate-500",children:Math.abs(P.remaining)<=xt?`✓ Within tolerance (±$${xt.toFixed(2)})`:`⚠️ Remaining amount of ${p(P.remaining)} will be posted automatically as a rounding adjustment (use a rounding account to override the default).`}),e.jsx("div",{className:"pt-3",children:e.jsx("button",{type:"button",onClick:gs,disabled:!P.isReady||g,className:`inline-flex w-full items-center justify-center rounded-full px-4 py-2 text-xs font-semibold shadow-sm ${!P.isReady||g?"cursor-not-allowed bg-slate-100 text-slate-400":"bg-slate-900 text-white hover:bg-black"}`,children:g?"Posting…":"Allocate"})})]})]}),F==="ADD"&&s&&e.jsxs("div",{className:"space-y-4 max-w-md",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Post this bank line directly to a single ledger account with optional tax. No splits required."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Direction"}),e.jsxs("div",{className:"inline-flex gap-1 rounded-full bg-slate-50 p-1 text-xs font-medium",children:[e.jsx("button",{type:"button",onClick:()=>ze("IN"),className:`rounded-full px-3 py-1 ${w==="IN"?"bg-white text-slate-900 shadow-sm":"text-slate-500"}`,children:"Money in"}),e.jsx("button",{type:"button",onClick:()=>ze("OUT"),className:`rounded-full px-3 py-1 ${w==="OUT"?"bg-white text-slate-900 shadow-sm":"text-slate-500"}`,children:"Money out"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 flex items-center justify-between",children:e.jsx("label",{className:"text-xs font-medium text-slate-600",children:"Category (ledger)"})}),e.jsx("select",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-white px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100 disabled:cursor-not-allowed disabled:bg-slate-100",value:z,onChange:t=>Ne(t.target.value),disabled:ct.length===0||g,children:ct.map(t=>e.jsx("option",{value:t.id,children:`${t.code?`${t.code} · `:""}${t.name}`},t.id))}),ct.length===0&&e.jsxs("p",{className:"mt-1 text-[11px] text-rose-500",children:["Add ",w==="IN"?"income":"expense/equity"," accounts to post this entry."]})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:[w==="IN"?"Customer":"Supplier"," (optional)"]}),e.jsxs("select",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-white px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100 disabled:cursor-not-allowed disabled:bg-slate-100",value:je,onChange:t=>Ke(t.target.value),disabled:g||(w==="IN"?Ue.length===0:Pe.length===0),children:[e.jsx("option",{value:"",children:w==="IN"?"No customer":"No supplier"}),(w==="IN"?Ue:Pe).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Category amount"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",type:"number",step:"0.01",value:Ye,onChange:t=>Je(t.target.value),disabled:g}),e.jsxs("p",{className:"mt-1 text-[11px] text-slate-500",children:["Bank amount: ",p(dt)]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 px-3 py-3",children:[e.jsx("div",{className:"mb-2 flex flex-wrap items-center justify-between gap-2",children:e.jsx("span",{className:"text-[11px] font-semibold text-slate-600",children:"Tax"})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("select",{value:Y,onChange:t=>jt(t.target.value),className:"h-9 rounded-full border border-slate-200 bg-white px-3 text-xs outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100",children:[e.jsx("option",{value:"NONE",children:"No tax"}),e.jsx("option",{value:"INCLUDED",children:"Tax included"}),e.jsx("option",{value:"ON_TOP",children:"Tax on top"})]}),e.jsx("select",{value:oe,onChange:t=>vt(t.target.value),disabled:Y==="NONE"||u.length===0,className:"h-9 rounded-full border border-slate-200 bg-white px-3 text-xs outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100 disabled:bg-slate-100",children:u.length===0?e.jsx("option",{value:"",children:"No tax codes"}):u.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.percentage,"%)"]},t.id))})]}),e.jsxs("p",{className:"mt-2 text-[11px] text-slate-600",children:["Net ",p(Te.net)," · Tax ",p(Te.tax)," · Gross"," ",p(Te.gross)]}),!Ot&&e.jsxs("p",{className:"mt-1 text-[11px] text-rose-600",children:["Gross must match the bank amount (",p(dt),"). Adjust the base amount or tax."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"Memo (optional)"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"Internal note",value:wt,onChange:t=>kt(t.target.value),disabled:g})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"button",onClick:ys,disabled:!Lt,className:`inline-flex items-center rounded-full px-4 py-1.5 text-xs font-semibold text-white shadow-sm ${Lt?"bg-emerald-600 hover:bg-emerald-700":"cursor-not-allowed bg-emerald-300"}`,children:g?"Posting…":"Add to bank account"})})]})]}),F==="TRANSFER"&&e.jsxs("div",{className:"space-y-5 max-w-md",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Use a transfer when this movement is between your own accounts (for example, moving money from checking to savings)."}),e.jsx("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2 text-[11px] text-slate-600",children:"Tax not applicable for pure transfers."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"From account"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",defaultValue:(d==null?void 0:d.name)||"",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-slate-600",children:"To account"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"e.g. Savings, Credit card"})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{className:"inline-flex items-center rounded-full bg-sky-600 px-4 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-sky-700",children:"Record transfer"})})]})]}),F==="EXCLUDE"&&e.jsxs("div",{className:"space-y-4 max-w-md",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Exclude this line if it's a duplicate, personal transaction, or otherwise not relevant to your business books. It will remain in the feed but won't affect your reports."}),e.jsx("div",{className:"rounded-2xl border border-rose-100 bg-rose-50 px-3 py-3 text-[11px] text-rose-700",children:"You can always undo this later from the bank feed if you exclude something by mistake."}),e.jsx("button",{type:"button",onClick:Ns,disabled:!s||s.status!=="NEW"||g,className:`inline-flex items-center rounded-full px-4 py-1.5 text-xs font-semibold ring-1 ${!s||s.status!=="NEW"||g?"cursor-not-allowed bg-slate-100 text-slate-400 ring-slate-200":"bg-white text-rose-600 ring-rose-200 hover:bg-rose-50"}`,children:"Exclude from books"})]})]})]}):bt?e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center px-8 py-10 text-center text-xs text-slate-400",children:e.jsx("p",{children:"Loading transaction…"})}):e.jsx("div",{className:"flex flex-1 flex-col items-center justify-center px-8 py-10 text-center text-xs text-slate-400",children:e.jsx("p",{children:"Select a transaction on the left to review or create a posting."})})})]})]})}),ns&&e.jsx("div",{className:"fixed inset-0 z-40 flex justify-end bg-slate-900/40",children:e.jsxs("div",{className:"flex h-full w-full max-w-lg flex-col bg-white shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-100 px-5 py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-[0.18em] text-slate-400",children:"Create category"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Add a new category without leaving this review."})]}),e.jsx("button",{type:"button",onClick:()=>ve(!1),className:"rounded-full border border-slate-200 bg-white px-2 py-1 text-[11px] text-slate-500 hover:bg-slate-50",children:"Close"})]}),e.jsxs("div",{className:"flex-1 space-y-4 overflow-y-auto px-5 py-4 text-xs text-slate-700",children:[Et&&e.jsx("div",{className:"rounded-2xl border border-rose-100 bg-rose-50 px-3 py-2 text-[11px] text-rose-600",children:Et}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-[11px] font-medium text-slate-500",children:"Type"}),e.jsxs("div",{className:"inline-flex gap-1 rounded-full bg-slate-50 p-1 text-[11px] font-medium",children:[e.jsx("button",{type:"button",onClick:()=>{const t=k;X(n=>{var l;return{...n,type:"EXPENSE",accountId:(l=t[0])!=null&&l.id?String(t[0].id):""}})},className:`rounded-full px-3 py-1 ${m.type==="EXPENSE"?"bg-white text-slate-900 shadow-sm":"text-slate-500"}`,children:"Expense"}),e.jsx("button",{type:"button",onClick:()=>{const t=E;X(n=>{var l;return{...n,type:"INCOME",accountId:(l=t[0])!=null&&l.id?String(t[0].id):""}})},className:`rounded-full px-3 py-1 ${m.type==="INCOME"?"bg-white text-slate-900 shadow-sm":"text-slate-500"}`,children:"Income"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-[11px] font-medium text-slate-500",children:"Name"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:m.type==="EXPENSE"?"e.g. Subscriptions":"e.g. Sales",value:m.name,onChange:t=>X(n=>({...n,name:t.target.value}))})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-[11px] font-medium text-slate-500",children:"Code"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"Optional",value:m.code,onChange:t=>X(n=>({...n,code:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-[11px] font-medium text-slate-500",children:"Account (optional)"}),e.jsxs("select",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-white px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:ring-2 focus:ring-sky-100",value:m.accountId,onChange:t=>X(n=>({...n,accountId:t.target.value})),children:[e.jsx("option",{value:"",children:"No linked account"}),(m.type==="EXPENSE"?k:E).map(t=>e.jsx("option",{value:t.id,children:`${t.code?`${t.code} · `:""}${t.name}`},t.id))]}),(m.type==="EXPENSE"?k:E).length===0&&e.jsxs("p",{className:"mt-1 text-[10px] text-slate-400",children:["Add ",m.type==="EXPENSE"?"expense":"income"," accounts in your COA to link this category."]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-[11px] font-medium text-slate-500",children:"Description"}),e.jsx("textarea",{className:"min-h-[70px] w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"What does this category cover?",value:m.description,onChange:t=>X(n=>({...n,description:t.target.value}))})]})]}),e.jsxs("div",{className:"border-t border-slate-100 px-5 py-3 text-right",children:[e.jsx("button",{type:"button",onClick:()=>ve(!1),className:"mr-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-[11px] font-medium text-slate-600 hover:bg-slate-50",children:"Cancel"}),e.jsx("button",{type:"button",onClick:ds,disabled:Ze,className:`inline-flex items-center rounded-full px-4 py-1.5 text-[11px] font-semibold text-white shadow-sm ${Ze?"cursor-not-allowed bg-slate-400":"bg-emerald-600 hover:bg-emerald-700"}`,children:Ze?"Saving…":"Save category"})]})]})}),ls&&e.jsx("div",{className:"fixed inset-0 z-40 flex justify-end bg-slate-900/40",children:e.jsxs("div",{className:"flex h-full w-full max-w-md flex-col bg-white shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-100 px-5 py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-semibold uppercase tracking-[0.18em] text-slate-400",children:"New transaction"}),e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Post a manual bank line for review"})]}),e.jsx("button",{type:"button",onClick:()=>we(!1),className:"rounded-full border border-slate-200 bg-white px-2 py-1 text-[11px] text-slate-500 hover:bg-slate-50",children:"Close"})]}),e.jsxs("div",{className:"flex-1 space-y-4 overflow-y-auto px-5 py-4 text-xs text-slate-700",children:[At&&e.jsx("div",{className:"rounded-2xl border border-rose-100 bg-rose-50 px-3 py-2 text-[11px] text-rose-600",children:At}),!(d!=null&&d.ledgerAccountId)&&e.jsx("div",{className:"rounded-2xl border border-amber-100 bg-amber-50 px-3 py-2 text-[11px] text-amber-700",children:"Link this bank account to a ledger account before creating manual transactions."}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-[11px] font-medium text-slate-500",children:"Type"}),e.jsxs("div",{className:"inline-flex gap-1 rounded-full bg-slate-50 p-1",children:[e.jsx("button",{type:"button",onClick:()=>et("IN"),className:`rounded-full px-3 py-1 text-[11px] font-medium ${ke==="IN"?"bg-white text-slate-900 shadow-sm":"text-slate-500"}`,children:"Money in"}),e.jsx("button",{type:"button",onClick:()=>et("OUT"),className:`rounded-full px-3 py-1 text-[11px] font-medium ${ke==="OUT"?"bg-white text-slate-900 shadow-sm":"text-slate-500"}`,children:"Money out"})]})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-[11px] font-medium text-slate-500",children:"Date"}),e.jsx("input",{type:"date",className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",value:tt,onChange:t=>St(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-[11px] font-medium text-slate-500",children:"Amount"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"rounded-2xl bg-slate-50 px-2 py-1 text-[11px] text-slate-500",children:os}),e.jsx("input",{type:"number",className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"0.00",value:Ee,onChange:t=>st(t.target.value)})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-[11px] font-medium text-slate-500",children:"Description"}),e.jsx("input",{className:"h-9 w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"What is this transaction for?",value:Ce,onChange:t=>at(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 text-[11px] font-medium text-slate-500",children:"Memo (optional)"}),e.jsx("textarea",{className:"min-h-[70px] w-full rounded-2xl border border-slate-200 bg-slate-50 px-3 py-2 text-xs text-slate-800 outline-none focus:border-sky-400 focus:bg-white focus:ring-2 focus:ring-sky-100",placeholder:"Internal note",value:nt,onChange:t=>lt(t.target.value)})]})]}),e.jsxs("div",{className:"border-t border-slate-100 px-5 py-3 text-right",children:[e.jsx("button",{type:"button",onClick:()=>we(!1),className:"mr-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-[11px] font-medium text-slate-600 hover:bg-slate-50",children:"Cancel"}),e.jsx("button",{type:"button",onClick:us,disabled:ot||!(d!=null&&d.ledgerAccountId),className:`inline-flex items-center rounded-full px-4 py-1.5 text-[11px] font-semibold text-white shadow-sm ${ot||!(d!=null&&d.ledgerAccountId)?"cursor-not-allowed bg-slate-400":"bg-slate-900 hover:bg-black"}`,children:ot?"Saving…":"Save transaction"})]})]})})]})}const Ht=document.getElementById("bank-feed-root");Ht&&ks.createRoot(Ht).render(e.jsx(Es.StrictMode,{children:e.jsx(Is,{})}));
