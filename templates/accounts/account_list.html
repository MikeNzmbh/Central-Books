{% extends "base.html" %}
{% load mb_extras %}

{% block title %}Chart of Accounts â€“ Mini-Books{% endblock %}

{% block content %}
<div class="mb-page-shell">
  <div class="mb-page-header">
    <div>
      <div class="mb-kicker">ACCOUNTS</div>
      <h1 class="mb-page-title">Chart of Accounts</h1>
      <p class="mb-page-subtitle">
        Live balances from the ledger as of {{ as_of }}.
      </p>
    </div>
    <div class="mb-page-actions">
      <button type="button" class="mb-btn mb-btn-pill mb-btn-secondary" disabled>
        As of {{ as_of }}
      </button>
    </div>
  </div>

  <div class="mb-page-grid">
    <div class="mb-page-main space-y-6">
      {% for acc_type, accounts in grouped_accounts.items %}
        <div class="mb-card">
          <div class="mb-card-header">
            <div>
              <h2 class="mb-card-title">
                {% if acc_type == "ASSET" %}Assets{% endif %}
                {% if acc_type == "LIABILITY" %}Liabilities{% endif %}
                {% if acc_type == "EQUITY" %}Equity{% endif %}
                {% if acc_type == "INCOME" %}Income{% endif %}
                {% if acc_type == "EXPENSE" %}Expenses{% endif %}
              </h2>
              <p class="mb-card-subtitle">Accounts of type {{ acc_type|title }}.</p>
            </div>
            <div class="mb-card-meta">
              Total: {{ totals_by_type|get_item:acc_type|default:"0.00" }}
            </div>
          </div>
          <div class="mb-card-body">
            <div class="overflow-x-auto">
              <table class="min-w-full text-sm">
                <thead>
                  <tr class="text-xs text-slate-500 border-b border-slate-100">
                    <th class="py-2 pr-4 text-left">Code</th>
                    <th class="py-2 pr-4 text-left">Name</th>
                    <th class="py-2 pr-4 text-right">Balance</th>
                  </tr>
                </thead>
                <tbody>
                  {% for acc in accounts %}
                    <tr class="border-b border-slate-50 hover:bg-slate-50/60">
                      <td class="py-2 pr-4 text-slate-500">{{ acc.code }}</td>
                      <td class="py-2 pr-4 text-slate-900 font-medium">
                        <a href="{% url 'account_detail' acc.id %}" class="hover:underline">
                          {{ acc.name }}
                        </a>
                      </td>
                      <td class="py-2 pr-4 text-right font-mono {% if acc.balance < 0 %}text-rose-600{% else %}text-slate-900{% endif %}">
                        {{ acc.balance }}
                      </td>
                    </tr>
                  {% empty %}
                    <tr>
                      <td colspan="3" class="py-4 text-xs text-slate-500">No activity yet.</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="mb-card">
          <div class="mb-card-body text-sm text-slate-500">
            No accounts have ledger activity yet.
          </div>
        </div>
      {% endfor %}
    </div>

    <div class="mb-page-side space-y-4">
      <div class="mb-card">
        <div class="mb-card-header">
          <h2 class="mb-card-title">Balance snapshot</h2>
        </div>
        <div class="mb-card-body text-xs space-y-2">
          <div class="flex justify-between">
            <span class="mb-overview-label">Total assets</span>
            <span class="mb-overview-value">{{ totals_by_type|get_item:"ASSET"|default:"0.00" }}</span>
          </div>
          <div class="flex justify-between">
            <span class="mb-overview-label">Total liabilities</span>
            <span class="mb-overview-value">{{ totals_by_type|get_item:"LIABILITY"|default:"0.00" }}</span>
          </div>
          <div class="flex justify-between">
            <span class="mb-overview-label">Total equity</span>
            <span class="mb-overview-value">{{ totals_by_type|get_item:"EQUITY"|default:"0.00" }}</span>
          </div>
          <div class="mt-3 text-[11px] text-slate-500">
            Assets should roughly equal Liabilities + Equity once opening balances are posted.
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
