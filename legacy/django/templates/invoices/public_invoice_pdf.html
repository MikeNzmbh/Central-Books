{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Invoice {{ invoice.invoice_number|default:invoice.id }}</title>
  <style>
    :root {
      --bg: #f5f5f7;
      --card: #ffffff;
      --border: #e5e5ea;
      --text: #0f172a;
      --muted: #6b7280;
      --accent: #2563eb;
      --pill: #e0f2fe;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    .shell {
      max-width: 840px;
      margin: 32px auto;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 14px 32px rgba(15, 23, 42, 0.08);
      padding: 28px 32px;
    }
    .header {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      align-items: flex-start;
      margin-bottom: 18px;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--pill);
      color: #0ea5e9;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.02em;
    }
    .title {
      margin: 6px 0 4px;
      font-size: 26px;
      font-weight: 700;
      letter-spacing: -0.01em;
    }
    .meta {
      margin: 2px 0;
      color: var(--muted);
      font-size: 12px;
    }
    .status {
      display: inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 12px;
      color: var(--muted);
      background: #f8fafc;
      margin-left: 6px;
    }
    .bill-box {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 14px;
      background: #f8fafc;
      min-width: 220px;
    }
    .section-title {
      margin: 16px 0 8px;
      font-size: 14px;
      font-weight: 700;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 4px;
      font-size: 13px;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid var(--border);
      text-align: left;
    }
    th {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 11px;
      color: var(--muted);
    }
    .summary {
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px 16px;
      background: #f8fafc;
      max-width: 280px;
    }
    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      font-size: 13px;
      border-bottom: 1px solid var(--border);
    }
    .summary-row.total {
      border-bottom: none;
      font-weight: 700;
      color: var(--accent);
      font-size: 15px;
    }
    .notes {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      background: #f8fafc;
      font-size: 13px;
      color: var(--text);
      margin-top: 12px;
    }
    .footer {
      margin-top: 24px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
      color: var(--muted);
      font-size: 12px;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="header">
      <div>
        <div class="pill">Invoice {{ invoice.invoice_number|default:invoice.id }}</div>
        <h1 class="title">{{ invoice.business.name|default:"" }}</h1>
        <p class="meta">
          Issued: {{ invoice.issue_date|default_if_none:"" }}{% if invoice.due_date %} · Due: {{ invoice.due_date }}{% endif %}
          {% if invoice.status %}<span class="status">{{ invoice.status }}</span>{% endif %}
        </p>
      </div>
      <div class="bill-box">
        <div class="meta" style="text-transform: uppercase; letter-spacing: 0.08em;">Billed to</div>
        <div style="font-weight: 600; margin-top: 4px;">{{ invoice.customer.name|default:"" }}</div>
        {% if invoice.customer.email %}<div class="meta">{{ invoice.customer.email }}</div>{% endif %}
        {% if invoice.customer.address %}<div class="meta">{{ invoice.customer.address }}</div>{% endif %}
      </div>
    </div>

    <div class="section-title">Line items</div>
    <table>
      <thead>
        <tr>
          <th>Description</th>
          <th style="width: 70px;">Qty</th>
          <th style="text-align:right; width: 120px;">Amount</th>
        </tr>
      </thead>
      <tbody>
        {% if invoice.lines.all %}
          {% for line in invoice.lines.all %}
          <tr>
            <td>{{ line.description|default:line.name|default:"Item" }}</td>
            <td>{{ line.quantity|default:"1" }}</td>
            <td style="text-align:right;">{{ line.total|default:line.amount|default_if_none:"0.00" }}</td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td>{{ invoice.description|default:"Services rendered" }}</td>
            <td>1</td>
            <td style="text-align:right;">{{ invoice.net_total|default:invoice.grand_total|default:invoice.total_amount|default_if_none:"0.00" }}</td>
          </tr>
        {% endif %}
      </tbody>
    </table>

    <div style="display: flex; gap: 16px; margin-top: 16px; flex-wrap: wrap;">
      {% if invoice.notes %}
      <div style="flex: 2 1 340px;">
        <div class="section-title" style="margin-top: 0;">Notes</div>
        <div class="notes">{{ invoice.notes }}</div>
      </div>
      {% endif %}
      <div style="flex: 1 1 240px;">
        <div class="section-title" style="margin-top: 0;">Summary</div>
        <div class="summary">
          <div class="summary-row">
            <span>Subtotal</span>
            <span>{{ invoice.net_total|default:invoice.total_amount|default_if_none:"0.00" }}</span>
          </div>
          <div class="summary-row">
            <span>Tax</span>
            <span>{{ invoice.tax_total|default_if_none:"0.00" }}</span>
          </div>
          <div class="summary-row total">
            <span>Total due</span>
            <span>{{ invoice.grand_total|default:invoice.net_total|default:invoice.total_amount|default_if_none:"0.00" }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">
      <div>Invoice ID: {{ invoice.id }}</div>
      <div>{{ invoice.business.name|default:"" }}{% if invoice.business.owner_user.email %} · {{ invoice.business.owner_user.email }}{% endif %}</div>
    </div>
  </div>
</body>
</html>
