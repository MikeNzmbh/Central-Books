{% extends "base.html" %}

{% block title %}Bank accounts – Clover Books{% endblock %}

{% block content %}
<div class="mb-page-shell">
  <div class="mb-page-header">
    <div>
      <div class="mb-kicker">BANKING</div>
      <h1 class="mb-page-title">Bank accounts</h1>
      <p class="mb-page-subtitle">
        Add the real-world accounts you use (operating, savings, cards, wallets). These drive the Bank Feed and CSV imports.
      </p>
    </div>
    <div class="mb-page-actions">
      <a href="{% url 'bank_account_create' %}" class="mb-btn mb-btn-pill mb-btn-primary">
        + New bank account
      </a>
    </div>
  </div>

  {% if rows %}
    <div class="mb-card">
      <div class="mb-card-header">
        <h2 class="mb-card-title">Your accounts</h2>
        <p class="mb-card-subtitle">Only these accounts appear in the Bank Feed and CSV uploads.</p>
      </div>
      <div class="mb-card-body p-0 overflow-hidden">
        <table class="min-w-full text-sm">
          <thead class="bg-slate-50 text-xs text-slate-500 uppercase tracking-[0.1em]">
            <tr>
              <th class="px-4 py-2 text-left">Display name</th>
              <th class="px-4 py-2 text-left">Role</th>
              <th class="px-4 py-2 text-left">Bank</th>
              <th class="px-4 py-2 text-left">Ledger link</th>
              <th class="px-4 py-2 text-right">Balance</th>
              <th class="px-4 py-2 text-right">Unreconciled</th>
              <th class="px-4 py-2 text-right"></th>
            </tr>
          </thead>
          <tbody>
            {% for row in rows %}
              {% with account=row.bank_account %}
              <tr class="border-b border-slate-100">
                <td class="px-4 py-3 font-medium text-slate-900">
                  {{ account.name }}
                  {% if account.account_number_mask %}
                    <span class="text-xs text-slate-400">•••• {{ account.account_number_mask }}</span>
                  {% endif %}
                </td>
                <td class="px-4 py-3 text-slate-600">{{ account.get_usage_role_display }}</td>
                <td class="px-4 py-3 text-slate-600">
                  {% if account.bank_name %}
                    {{ account.bank_name }}
                  {% else %}
                    <span class="text-slate-400">—</span>
                  {% endif %}
                </td>
                <td class="px-4 py-3 text-slate-600">
                  {% if account.account %}
                    {{ account.account.code }} – {{ account.account.name }}
                  {% else %}
                    <span class="text-slate-400">Not linked</span>
                  {% endif %}
                </td>
                <td class="px-4 py-3 text-right font-mono">
                  {{ row.balance|floatformat:2 }}
                </td>
                <td class="px-4 py-3 text-right text-slate-600">
                  {{ row.unreconciled }}
                </td>
                <td class="px-4 py-3 text-right">
                  <a href="{% url 'bank_account_edit' account.pk %}" class="text-sky-600 hover:underline">Edit</a>
                </td>
              </tr>
              {% endwith %}
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% else %}
    <div class="mb-card">
      <div class="mb-card-body">
        <h2 class="mb-card-title mb-2">No bank accounts yet</h2>
        <p class="mb-card-subtitle mb-4">
          Start by adding the accounts you reconcile (operating, savings, cards). Once added, they unlock the Bank Feed and CSV import.
        </p>
        <a href="{% url 'bank_account_create' %}" class="mb-btn mb-btn-pill mb-btn-primary">+ New bank account</a>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}
